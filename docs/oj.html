<!DOCTYPE html>

<html>
<head>
  <title>oj.litcoffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>oj.litcoffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1>oj</h1>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>A unified templating framework for the people. Thirsty people.</p>
<h2>oj function</h2>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Convert ojml to dom</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">oj</span></span> = -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>  oj function acts like a tag method that doesn&#39;t emit</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  oj._argsPush()
  ojml = oj.emit.apply @, arguments
  oj._argsPop()
  ojml</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h2>Export Model to NodeJS or globally</h2>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>  Remember root context</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>root = @</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>  Define oj version</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.version = <span class="string">'0.1.2'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>  Detect if this is client or server-side</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.isClient = <span class="keyword">not</span> process?.versions?.node</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>  Export as a module in node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">if</span> <span class="keyword">typeof</span> module != <span class="string">'undefined'</span>
  exports = module.exports = oj</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>  Export globally if not in node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">else</span>
  root[<span class="string">'oj'</span>] = oj</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>  Reference ourselves for template files to see</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.oj = oj</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h2>oj.load</h2>

            </div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Load the page specified generating necessary html, css, and client side events.
TODO: Static server side support for loading any generated pages dynamically.
TODO: Support Backbone routes to trigger page changes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">load</span></span> = (page) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>  Defer dom manipulation until the page is ready</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  jQuery -&gt;

    $.ojBody (require page)</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>  Trigger events bound through onload</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    oj.onload()</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <h2>oj.onload</h2>

            </div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Enlist in onload action.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>_onLoadQueue = queue:[], loaded:<span class="literal">false</span>
oj.<span class="function"><span class="title">onload</span></span> = (f) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>  Call everything if no arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> oj.isUndefined f
    _onLoadQueue.loaded = <span class="literal">true</span>
    <span class="keyword">while</span> (f = _onLoadQueue.queue.shift())
      f()</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>  Call load if already loaded</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">else</span> <span class="keyword">if</span> _onLoadQueue.loaded
    f()</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>  Queue function for later</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">else</span>
    _onLoadQueue.queue.push f
  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <h2>oj.emit</h2>

            </div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Emit arguments as a tag would.
Used by plugins to group multiple elements as if it is a single tag.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">emit</span></span> = -&gt;
  ojml = oj.tag <span class="string">'oj'</span>, arguments...</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <h2>oj.id</h2>

            </div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Generate a unique oj id</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">id</span></span> = (len, chars) -&gt;
  <span class="string">'oj'</span> + oj.guid len, chars</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h2>oj.guid</h2>

            </div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Generate a unique guid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_randomInteger</span></span> = (min, max) -&gt;
  <span class="keyword">return</span> <span class="literal">null</span> <span class="keyword">if</span> min == <span class="literal">null</span> <span class="keyword">or</span> max == <span class="literal">null</span> <span class="keyword">or</span> min &gt; max
  diff = max - min;</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>random int from zero to number minus one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  rnd = Math.floor Math.random() * (diff + <span class="number">1</span>)
  rnd + min

_chars = <span class="string">"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"</span>.split <span class="string">''</span>
oj.<span class="function"><span class="title">guid</span></span> = (len = <span class="number">8</span>, chars = _chars) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Default arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  base = chars.length</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Calculate how many chars can be determined by each random call</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  charsPerRand = Math.floor Math.log(Math.pow(<span class="number">2</span>,<span class="number">31</span>)-<span class="number">1</span>) / Math.log(base)
  randMin = <span class="number">0</span>
  randMax = Math.pow(base, charsPerRand)-<span class="number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Calculate random chars by calling random the minimum number of times</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  output = <span class="string">""</span>
  <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..len]</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Generate random number</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> i % charsPerRand == <span class="number">0</span>
      rand = _randomInteger randMin, randMax
    charNext = chars[rand % base]
    output += charNext
    rand = Math.floor(rand / base)

  output</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <h2>Type Helpers</h2>

            </div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Short names for common prototype and method names</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>ArrayP = Array.prototype
FuncP = Function.prototype
ObjP = Object.prototype

slice = ArrayP.slice
unshift = ArrayP.unshift
concat = ArrayP.concat</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Type helper for oj types</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">isOJ</span></span> = (obj) -&gt; !!(obj?.isOJ)</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Type helper for event enabled objects such as Backbone models</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">isEvent</span></span> = (obj) -&gt; !!(obj <span class="keyword">and</span> obj.<span class="literal">on</span> <span class="keyword">and</span> obj.<span class="literal">off</span> <span class="keyword">and</span> obj.trigger)</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Type helper for DOM element types</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">isDOM</span></span> = (obj) -&gt; !!(obj <span class="keyword">and</span> obj.nodeType?)
oj.<span class="function"><span class="title">isDOMElement</span></span> = (obj) -&gt; !!(obj <span class="keyword">and</span> obj.nodeType == <span class="number">1</span>)
oj.<span class="function"><span class="title">isDOMAttribute</span></span> = (obj) -&gt; !!(obj <span class="keyword">and</span> obj.nodeType == <span class="number">2</span>)
oj.<span class="function"><span class="title">isDOMText</span></span> = (obj) -&gt; !!(obj <span class="keyword">and</span> obj.nodeType == <span class="number">3</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Type helper for jQuery</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">isjQuery</span></span> = (obj) -&gt; !!(obj <span class="keyword">and</span> obj.jquery)</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Type helpers for basic types. Based on <a href="http://underscorejs.org/">underscore.js</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">isUndefined</span></span> = (obj) -&gt; obj == <span class="literal">undefined</span>
oj.<span class="function"><span class="title">isBoolean</span></span> = (obj) -&gt; obj == <span class="literal">true</span> <span class="keyword">or</span> obj == <span class="literal">false</span> <span class="keyword">or</span> ObjP.toString.call(obj) == <span class="string">'[object Boolean]'</span>
oj.<span class="function"><span class="title">isNumber</span></span> = (obj) -&gt; !!(obj == <span class="number">0</span> <span class="keyword">or</span> (obj <span class="keyword">and</span> obj.toExponential <span class="keyword">and</span> obj.toFixed))
oj.<span class="function"><span class="title">isString</span></span> = (obj) -&gt; !!(obj == <span class="string">''</span> <span class="keyword">or</span> (obj <span class="keyword">and</span> obj.charCodeAt <span class="keyword">and</span> obj.substr))
oj.<span class="function"><span class="title">isDate</span></span> = (obj) -&gt; !!(obj <span class="keyword">and</span> obj.getTimezoneOffset <span class="keyword">and</span> obj.setUTCFullYear)
oj.<span class="function"><span class="title">isFunction</span></span> = (obj) -&gt; <span class="keyword">typeof</span> obj == <span class="string">'function'</span>
oj.isArray = Array.isArray <span class="keyword">or</span> (obj) -&gt; ObjP.toString.call(obj) == <span class="string">'[object Array]'</span>
oj.<span class="function"><span class="title">isRegEx</span></span> = (obj) -&gt; ObjP.toString.call(obj) == <span class="string">'[object RegExp]'</span>
oj.<span class="function"><span class="title">isArguments</span></span> = (obj) -&gt; ObjP.toString.call(obj) == <span class="string">'[object Arguments]'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Type helper for is defined</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">isDefined</span></span> = (obj) -&gt; <span class="keyword">not</span> (<span class="keyword">typeof</span> obj == <span class="string">'undefined'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <h2>oj.typeOf</h2>

            </div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Mimic behavior of built-in typeof operator and integrate jQuery, Backbone, and OJ types</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">typeOf</span></span> = (any) -&gt;

  <span class="keyword">return</span> <span class="string">'null'</span> <span class="keyword">if</span> any == <span class="literal">null</span>
  t = <span class="keyword">typeof</span> any
  <span class="keyword">if</span> t == <span class="string">'object'</span>
    <span class="keyword">if</span> oj.isArray any                     <span class="keyword">then</span> t = <span class="string">'array'</span>
    <span class="keyword">else</span> <span class="keyword">if</span> oj.isOJ any                   <span class="keyword">then</span> t = any.typeName
    <span class="keyword">else</span> <span class="keyword">if</span> oj.isRegEx any                <span class="keyword">then</span> t = <span class="string">'regexp'</span>
    <span class="keyword">else</span> <span class="keyword">if</span> oj.isDate any                 <span class="keyword">then</span> t = <span class="string">'date'</span>
    <span class="keyword">else</span> <span class="keyword">if</span> oj.isDOMElement any           <span class="keyword">then</span> t = <span class="string">'dom-element'</span>
    <span class="keyword">else</span> <span class="keyword">if</span> oj.isDOMText any              <span class="keyword">then</span> t = <span class="string">'dom-text'</span>
    <span class="keyword">else</span> <span class="keyword">if</span> oj.isDOMAttribute any         <span class="keyword">then</span> t = <span class="string">'dom-attribute'</span>
    <span class="keyword">else</span> <span class="keyword">if</span> oj.isjQuery any               <span class="keyword">then</span> t = <span class="string">'jquery'</span>
    <span class="keyword">else</span>                                  t = <span class="string">'object'</span>
  t</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>oj.parse: Convert string to basic type, number, boolean, null, or undefined</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">parse</span></span> = (str) -&gt;
  <span class="keyword">if</span> str == <span class="string">'undefined'</span>
    <span class="literal">undefined</span>
  <span class="keyword">else</span> <span class="keyword">if</span> str == <span class="string">'null'</span>
    <span class="literal">null</span>
  <span class="keyword">else</span> <span class="keyword">if</span> str == <span class="string">'true'</span>
    <span class="literal">true</span>
  <span class="keyword">else</span> <span class="keyword">if</span> str == <span class="string">'false'</span>
    <span class="literal">false</span>
  <span class="keyword">else</span> <span class="keyword">if</span> !(isNaN(number = parseFloat str))
    number
  <span class="keyword">else</span>
    str</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>oj.isObject: Determine if object is a vanilla object type</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">isObject</span></span> = (obj) -&gt; (oj.typeOf obj) == <span class="string">'object'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <h2>Utility Helpers</h2>

            </div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_isCapitalLetter</span></span> = (c) -&gt; !!(c.match <span class="regexp">/[A-Z]/</span>)
<span class="function"><span class="title">_identity</span></span> = (v) -&gt; v
<span class="function"><span class="title">_has</span></span> = (obj, key) -&gt; ObjP.hasOwnProperty.call(obj, key)
_keys = Object.keys || (obj) -&gt;
  <span class="keyword">throw</span> <span class="string">'Invalid object'</span> <span class="keyword">if</span> obj != Object(obj)
  keys = [];
  <span class="keyword">for</span> key <span class="keyword">of</span> obj
    <span class="keyword">if</span> _has obj, key
      keys[keys.length] = key;
  keys
<span class="function"><span class="title">_values</span></span> = (obj) -&gt;
  <span class="keyword">throw</span> <span class="string">'Invalid object'</span> <span class="keyword">if</span> obj != Object(obj)
  out = []
  _each obj, (v) -&gt; out.push v
  out

<span class="function"><span class="title">_flatten</span></span> = (array, shallow) -&gt;
  _reduce array, ((memo, value) -&gt;
    <span class="keyword">if</span> oj.isArray value
      <span class="keyword">return</span> memo.concat(<span class="keyword">if</span> shallow <span class="keyword">then</span> value <span class="keyword">else</span> _flatten(value))
    memo[memo.length] = value
    memo
  ), []

<span class="function"><span class="title">_reduce</span></span> = (obj = [], iterator, memo, context) -&gt;
  initial = arguments.length &gt; <span class="number">2</span>
  <span class="keyword">if</span> ArrayP.reduce <span class="keyword">and</span> obj.reduce == ArrayP.reduce
    <span class="keyword">if</span> context
      iterator = _bind iterator, context
    <span class="keyword">return</span> <span class="keyword">if</span> initial <span class="keyword">then</span> obj.reduce iterator, memo <span class="keyword">else</span> obj.reduce iterator

  _each obj, (value, index, list) -&gt;
    <span class="keyword">if</span> (!initial)
      memo = value
      initial = <span class="literal">true</span>
    <span class="keyword">else</span>
      memo = iterator.call context, memo, value, index, list

  <span class="keyword">if</span> !initial
    <span class="keyword">throw</span> <span class="keyword">new</span> TypeError <span class="string">'Reduce of empty array with no initial value'</span>
  memo

  <span class="function"><span class="title">ctor</span></span> = -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>_bind: Helper to bind context to function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="title">_bind</span></span> = (func, context) -&gt;
    <span class="keyword">if</span> func.bind == FuncP.bind <span class="keyword">and</span> FuncP.bind
      <span class="keyword">return</span> FuncP.bind.apply func, slice.call(arguments, <span class="number">1</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>  Safari 5.1 doesn&#39;t implement bind in some iOS versions
  TODO: Remove when iOS 6 reaches 95% adoption</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    args = slice.call arguments, <span class="number">2</span>
    <span class="keyword">return</span> <span class="function"><span class="title">bound</span></span> = -&gt;
      <span class="keyword">unless</span> <span class="keyword">this</span> <span class="keyword">instanceof</span> bound
        <span class="keyword">return</span> func.apply context, args.concat(slice.call arguments)
      ctor.prototype = func.prototype
      self = <span class="keyword">new</span> ctor
      result = func.apply self, args.concat(slice.call(arguments))
      <span class="keyword">if</span> Object(result) == result
        <span class="keyword">return</span> result
      self

<span class="function"><span class="title">_sortedIndex</span></span> = (array, obj, iterator = _identity) -&gt;
  low = <span class="number">0</span>
  high = array.length;
  <span class="keyword">while</span> low &lt; high
    mid = (low + high) &gt;&gt; <span class="number">1</span>;
    <span class="keyword">if</span> iterator(array[mid]) &lt; iterator(obj) <span class="keyword">then</span> low = mid + <span class="number">1</span> <span class="keyword">else</span> high = mid;
  low</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>  _indexOf</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_indexOf</span></span> = (array, item, isSorted) -&gt;
  <span class="keyword">return</span> -<span class="number">1</span> <span class="keyword">unless</span> array?
  <span class="keyword">if</span> isSorted
    i = _sortedIndex array, item
    <span class="keyword">return</span> <span class="keyword">if</span> array[i] == item <span class="keyword">then</span> i <span class="keyword">else</span> -<span class="number">1</span>
  <span class="keyword">if</span> ArrayP.indexOf <span class="keyword">and</span> array.indexOf == ArrayP.indexOf
    <span class="keyword">return</span> array.indexOf item
  -<span class="number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>  _toArray</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_toArray</span></span> = (obj) -&gt;
  <span class="keyword">return</span> [] <span class="keyword">if</span> !obj
  <span class="keyword">return</span> slice.call obj <span class="keyword">if</span> oj.isArray obj
  <span class="keyword">return</span> slice.call obj <span class="keyword">if</span> oj.isArguments obj
  <span class="keyword">return</span> obj.toArray() <span class="keyword">if</span> obj.toArray <span class="keyword">and</span> oj.isFunction(obj.toArray)
  _values obj</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>  _isEmpty</p>
<p>Determine if object or array is empty</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_isEmpty</span></span> = (obj) -&gt;
  <span class="keyword">return</span> obj.length == <span class="number">0</span> <span class="keyword">if</span> oj.isArray obj
  <span class="keyword">for</span> k <span class="keyword">of</span> obj
    <span class="keyword">if</span> _has obj, k
      <span class="keyword">return</span> <span class="literal">false</span>
  <span class="literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>  _clone</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_clone</span></span> = (obj) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>TODO: support cloning OJ instances</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">return</span> obj <span class="keyword">unless</span> (oj.isArray obj) <span class="keyword">or</span> (oj.isObject obj)
  <span class="keyword">if</span> oj.isArray obj <span class="keyword">then</span> obj.slice() <span class="keyword">else</span> _extend {}, obj</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>  _contains</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_contains</span></span> = (obj, target) -&gt;
  <span class="keyword">if</span> <span class="keyword">not</span> obj?
    <span class="keyword">return</span> <span class="literal">false</span>
  <span class="keyword">if</span> ArrayP.indexOf <span class="keyword">and</span> obj.indexOf == ArrayP.indexOf
    <span class="keyword">return</span> obj.indexOf(target) != -<span class="number">1</span>
  _some obj, (value) -&gt; value == target</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>  _some</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_some</span></span> = (obj, iterator, context) -&gt;
    iterator ?= _identity
    result = <span class="literal">false</span>
    <span class="keyword">if</span> <span class="keyword">not</span> obj?
      <span class="keyword">return</span> result
    <span class="keyword">if</span> ArrayP.some <span class="keyword">and</span> obj.some == ArrayP.some
      <span class="keyword">return</span> obj.some iterator, context
    _each obj, (value, index, list) -&gt;
      <span class="keyword">if</span> result <span class="keyword">or</span> (result = iterator.call(context, value, index, list))
        <span class="keyword">return</span> breaker
    <span class="keyword">return</span> !!result</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>_setObject: Set object deeply and ensure each part is an object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_setObject</span></span> = (obj, keys..., value) -&gt;

  o = obj
  <span class="keyword">for</span> k,ix <span class="keyword">in</span> keys</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>  Initialize key to empty object if necessary</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> <span class="keyword">typeof</span> o[k] != <span class="string">'object'</span>

      o[k] = {} <span class="keyword">unless</span> (<span class="keyword">typeof</span> o[k] == <span class="string">'object'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>  Set final value if this is the last key</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> ix == keys.length - <span class="number">1</span>
      o[k] = value
      <span class="keyword">break</span></pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>  Continue deeper</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    o = o[k]

  obj</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <h2>Functional Helpers</h2>

            </div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>  _each</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>_breaker = {}

<span class="function"><span class="title">_each</span></span> = (col, iterator, context) -&gt;

  <span class="keyword">return</span> <span class="keyword">if</span> col == <span class="literal">null</span>
  <span class="keyword">if</span> ArrayP.forEach <span class="keyword">and</span> col.forEach == ArrayP.forEach
    col.forEach iterator, context
  <span class="keyword">else</span> <span class="keyword">if</span> oj.isArray col
    <span class="keyword">for</span> v, i <span class="keyword">in</span> col
      <span class="keyword">if</span> iterator.call(context, v, i, col) == _breaker
        <span class="keyword">return</span> _breaker
  <span class="keyword">else</span>
    <span class="keyword">for</span> k, v <span class="keyword">of</span> col
      <span class="keyword">if</span> _has col, k
        <span class="keyword">if</span> iterator.call(context, v, k, col) == _breaker
          <span class="keyword">return</span> _breaker</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>  _map</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">_map</span></span> = (obj, iterator, options = {}) -&gt;

  context = options.context
  recurse = options.recurse
  evaluate = options.evaluate</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Recurse if necessary</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  iterator_ = iterator
  <span class="keyword">if</span> recurse
    <span class="keyword">do</span> (options) -&gt;
      <span class="function"><span class="title">iterator_</span></span> = (v,k,o) -&gt;
        options_ = _extend (_clone options), (key: k, object: v)
        oj._map v, iterator, options_</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Evaluate functions if necessary</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> oj.isFunction obj</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Functions pass through if evaluate isn&#39;t set</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">return</span> obj <span class="keyword">unless</span> evaluate

    <span class="keyword">while</span> evaluate <span class="keyword">and</span> oj.isFunction obj
      obj = obj()

  out = obj</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Array case</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> oj.isArray obj
    out = []
    <span class="keyword">return</span> out <span class="keyword">unless</span> obj
    <span class="keyword">return</span> (obj.map iterator_, context) <span class="keyword">if</span> ArrayP.map <span class="keyword">and</span> obj.map == ArrayP.map
    _each(obj, ((v, ix, list) -&gt;
      out[out.length] = iterator_.call context, v, ix, list
    ))

    <span class="keyword">if</span> obj.length == +obj.length
      out.length = obj.length</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Object case</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">else</span> <span class="keyword">if</span> oj.isObject obj
    out = {}
    <span class="keyword">return</span> out <span class="keyword">unless</span> obj
    <span class="keyword">for</span> k,v <span class="keyword">of</span> obj</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Returning undefined will omit the thing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (r = iterator_.call(context, v, k, obj)) != <span class="literal">undefined</span>
        out[k] = r</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>Basis of recursive case</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">else</span>
    <span class="keyword">return</span> iterator.call context, obj, options.key, options.object,
  out</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>  _extend</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_extend</span></span> = (obj) -&gt;
  _each(slice.call(arguments, <span class="number">1</span>), ((source) -&gt;
    <span class="keyword">for</span> key, value <span class="keyword">of</span> source
      obj[key] = value
  ))
  obj</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>  _defaults</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_defaults</span></span> = (obj) -&gt;
  _each(slice.call(arguments, <span class="number">1</span>), ((source) -&gt;
    <span class="keyword">for</span> prop <span class="keyword">of</span> source
      <span class="keyword">if</span> <span class="keyword">not</span> obj[prop]?
        obj[prop] = source[prop]
  ))
  obj</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>  _omit</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_omit</span></span> = (obj) -&gt;
  copy = {}
  keys = concat.apply ArrayP, slice.call(arguments, <span class="number">1</span>)
  <span class="keyword">for</span> key <span class="keyword">of</span> obj
    <span class="keyword">if</span> <span class="keyword">not</span> _contains keys, key
      copy[key] = obj[key]
  copy</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>  _uniqueSort</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_uniqueSort</span></span> = (array, isSorted = <span class="literal">false</span>) -&gt;
  <span class="keyword">if</span> <span class="keyword">not</span> isSorted
    array.sort()
  out = []
  <span class="keyword">for</span> item,ix <span class="keyword">in</span> array
    <span class="keyword">if</span> ix &gt; <span class="number">0</span> <span class="keyword">and</span> array[ix-<span class="number">1</span>] == array[ix]
      <span class="keyword">continue</span>
    out.push item
  out</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>  _uniqueSortedUnion</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_uniqueSortedUnion</span></span> = (arr, arr2) -&gt;
  _uniqueSort (arr.concat arr2)</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <h2>Indexing Helpers</h2>

            </div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>  _boundOrThrow: Bound index to allow negatives, throw when out of range</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_boundOrThrow</span></span> = (ix, count, message, method) -&gt;
  ixNew = <span class="keyword">if</span> ix &lt; <span class="number">0</span> <span class="keyword">then</span> ix + count <span class="keyword">else</span> ix
  <span class="keyword">unless</span> <span class="number">0</span> &lt;= ixNew <span class="keyword">and</span> ixNew &lt; count
    <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"oj.<span class="subst">#{method}</span><span class="subst">#{message}</span> is out of bounds (<span class="subst">#{ix}</span> in [0,<span class="subst">#{count-<span class="number">1</span>}</span>])"</span>)
  ixNew</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <h2>String Helpers</h2>

            </div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>  _splitAndTrim: Split string by seperator and trim the resulting values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_splitAndTrim</span></span> = (str, seperator, limit) -&gt;
  r = str.split seperator, limit
  oj._map r, (v) -&gt; v.trim()</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>  _dasherize: Convert from camal case or space seperated to dashes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_dasherize</span></span> = (str) -&gt;
  _decamelize(str).replace <span class="regexp">/[ _]/g</span>, <span class="string">'-'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>  _decamelize: Convert from camal case to underscore case</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_decamelize</span></span> = (str) -&gt;
  str.replace(<span class="regexp">/([a-z])([A-Z])/g</span>, <span class="string">'$1_$2'</span>).toLowerCase()</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <h2>Path Helpers</h2>

            </div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>Used to implement require client side. These methods are simplified versions of
the node <code>path</code> library: github.com/joyent/node/lib/path.js</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>_pathSplitRe = <span class="regexp">/^(\/?)([\s\S]+\/(?!$)|\/)?((?:\.{1,2}$|[\s\S]+?)?(\.[^.\/]*)?)$/</span>
<span class="function"><span class="title">_pathSplit</span></span> = (filename) -&gt;
  result = _pathSplitRe.exec filename
  [result[<span class="number">1</span>] <span class="keyword">or</span> <span class="string">''</span>, result[<span class="number">2</span>] <span class="keyword">or</span> <span class="string">''</span>, result[<span class="number">3</span>] <span class="keyword">or</span> <span class="string">''</span>, result[<span class="number">4</span>] <span class="keyword">or</span> <span class="string">''</span>]
<span class="function"><span class="title">_pathNormalizeArray</span></span> = (parts, allowAboveRoot) -&gt;
  up = <span class="number">0</span>
  i = parts.length - <span class="number">1</span>
  <span class="keyword">while</span> i &gt;= <span class="number">0</span>
    last = parts[i]
    <span class="keyword">if</span> last == <span class="string">'.'</span>
      parts.splice i, <span class="number">1</span>
    <span class="keyword">else</span> <span class="keyword">if</span> last == <span class="string">'..'</span>
      parts.splice i, <span class="number">1</span>
      up++
    <span class="keyword">else</span> <span class="keyword">if</span> up
      parts.splice i, <span class="number">1</span>
      up--
    i--
  <span class="keyword">if</span> allowAboveRoot
    <span class="keyword">while</span> up--
      parts.unshift <span class="string">'..'</span>
  parts

oj.<span class="function"><span class="title">_pathResolve</span></span> = -&gt;
  resolvedPath = <span class="string">''</span>
  resolvedAbsolute = <span class="literal">false</span>
  i = arguments.length-<span class="number">1</span>
  <span class="keyword">while</span> i &gt;= -<span class="number">1</span> <span class="keyword">and</span> !resolvedAbsolute
    path = <span class="keyword">if</span> (i &gt;= <span class="number">0</span>) <span class="keyword">then</span> arguments[i] <span class="keyword">else</span> process.cwd()
    <span class="keyword">if</span> (<span class="keyword">typeof</span> path != <span class="string">'string'</span>) <span class="keyword">or</span> !path
      <span class="keyword">continue</span>
    resolvedPath = path + <span class="string">'/'</span> + resolvedPath
    resolvedAbsolute = path.charAt(<span class="number">0</span>) == <span class="string">'/'</span>
    i--
  resolvedPath = _pathNormalizeArray(resolvedPath.split(<span class="string">'/'</span>).filter((p) -&gt;
    <span class="keyword">return</span> !!p
  ), !resolvedAbsolute).join(<span class="string">'/'</span>)

  ((<span class="keyword">if</span> resolvedAbsolute <span class="keyword">then</span> <span class="string">'/'</span> <span class="keyword">else</span> <span class="string">''</span>) + resolvedPath) <span class="keyword">or</span> <span class="string">'.'</span>

oj.<span class="function"><span class="title">_pathNormalize</span></span> = (path) -&gt;
  isAbsolute = path.charAt(<span class="number">0</span>) == <span class="string">'/'</span>
  trailingSlash = path.substr(-<span class="number">1</span>) == <span class="string">'/'</span>
  path = _pathNormalizeArray(path.split(<span class="string">'/'</span>).filter((p) -&gt;
    !!p
  ), !isAbsolute).join(<span class="string">'/'</span>)
  <span class="keyword">if</span> !path <span class="keyword">and</span> !isAbsolute
    path = <span class="string">'.'</span>
  <span class="keyword">if</span> path <span class="keyword">and</span> trailingSlash
    path += <span class="string">'/'</span>
  (<span class="keyword">if</span> isAbsolute <span class="keyword">then</span> <span class="string">'/'</span> <span class="keyword">else</span> <span class="string">''</span>) + path

oj.<span class="function"><span class="title">_pathJoin</span></span> = -&gt;
  paths = ArrayP.slice.call arguments, <span class="number">0</span>
  oj._pathNormalize(paths.filter((p, index) -&gt;
    p <span class="keyword">and</span> <span class="keyword">typeof</span> p == <span class="string">'string'</span>
  ).join(<span class="string">'/'</span>))

oj.<span class="function"><span class="title">_pathDirname</span></span> = (path) -&gt;
  result = _pathSplit path
  root = result[<span class="number">0</span>]
  dir = result[<span class="number">1</span>]
  <span class="keyword">if</span> !root <span class="keyword">and</span> !dir
    <span class="keyword">return</span> <span class="string">'.'</span>
  <span class="keyword">if</span> dir
    dir = dir.substr <span class="number">0</span>, dir.length - <span class="number">1</span>
  root + dir</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <h2>oj.dependency</h2>

            </div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>Ensure dependencies through oj plugins</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">dependency</span></span> = (name) -&gt;
  obj = <span class="keyword">if</span> oj.isClient <span class="keyword">then</span> window[name] <span class="keyword">else</span> global[name]
  <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"oj: <span class="subst">#{name}</span> dependency is missing"</span>) <span class="keyword">unless</span> oj.isDefined obj</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>Depend on jQuery</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.dependency <span class="string">'jQuery'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <h2>oj.addMethod</h2>

            </div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>Add multiple methods to an object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">addMethods</span></span> = (obj, mapNameToMethod) -&gt;
  <span class="keyword">for</span> methodName, method <span class="keyword">of</span> mapNameToMethod
    oj.addMethod obj, methodName, method
  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <h2>oj.addMethod</h2>

            </div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>Add method to an object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">addMethod</span></span> = (obj, methodName, method) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>  Validate input</p>
<p>throw &#39;oj.addMethod: object expected for first argument&#39; unless oj.isObject obj</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">throw</span> <span class="string">'oj.addMethod: string expected for second argument'</span> <span class="keyword">unless</span> oj.isString methodName
  <span class="keyword">throw</span> <span class="string">'oj.addMethod: function expected for thrid argument'</span> <span class="keyword">unless</span> oj.isFunction method</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>  Methods are non-enumerable, non-writable properties</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Object.defineProperty obj, methodName,
    value: method
    enumerable: <span class="literal">false</span>
    writable: <span class="literal">false</span>
    configurable: <span class="literal">true</span>
  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <h2>oj.removeMethod</h2>

            </div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>Remove a method from an object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">removeMethod</span></span> = (obj, methodName) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>  Validate inputs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">throw</span> <span class="string">'oj.removeMethod: string expected for second argument'</span> <span class="keyword">unless</span> oj.isString methodName</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>  Remove the method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">delete</span> obj[methodName]
  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <h2>oj.addProperties</h2>

            </div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>Add multiple properties to an object</p>
<p>Properties can be specified by get/set methods or by a value</p>
<p>Value Property:
<code>age: 7    # defaults to {writable:true, enumerable:true}</code></p>
<p>Value Property with specified writable/enumerable:
<code>age: {value:7, writable:false, enumerable:false}</code></p>
<p>Readonly Get Property
<code>age: {get:(-&gt; 7)}</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">addProperties</span></span> = (obj, mapNameToInfo) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>  Iterate over properties</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">for</span> propName, propInfo <span class="keyword">of</span> mapNameToInfo</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>  Wrap the value if propInfo is not already a property definition</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> <span class="keyword">not</span> propInfo?.get? <span class="keyword">and</span> <span class="keyword">not</span> propInfo?.value?
      propInfo = value: propInfo, writable:<span class="literal">true</span>

    oj.addProperty obj, propName, propInfo

  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <h2>oj.addProperty</h2>

            </div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">addProperty</span></span> = (obj, propName, propInfo) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p>Validate input</p>
<p>throw new Error(&#39;oj.addProperty: obj expected for first argument&#39;) unless oj.isObject obj</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'oj.addProperty: string expected for second argument'</span>) <span class="keyword">unless</span> oj.isString propName

  <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'oj.addProperty: object expected for third argument'</span>) <span class="keyword">unless</span> oj.isObject propInfo</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>Default properties to enumerable and configurable</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _defaults propInfo,
    enumerable: <span class="literal">true</span>
    configurable: <span class="literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>Remove property if it already exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> Object.getOwnPropertyDescriptor(obj, propName)?
    oj.removeProperty obj, propName</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <p>Add the property</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Object.defineProperty obj, propName, propInfo
  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <h2>oj.removeProperty</h2>

            </div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">removeProperty</span></span> = (obj, propName) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>Validate input</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'oj.addProperty: string expected for second argument'</span>) <span class="keyword">unless</span> oj.isString propName</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <p>Remove property</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">delete</span> obj[propName]</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <h2>oj.isProperty</h2>

            </div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <p>Determine if the specified key is was defined by addProperty</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">isProperty</span></span> = (obj, propName) -&gt;
  <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'oj.isProperty: string expected for second argument'</span>) <span class="keyword">unless</span> oj.isString propName

  Object.getOwnPropertyDescriptor(obj, propName).get?</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <h2>oj.copyProperty</h2>

            </div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <p>Determine copy source.propName to dest.propName</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">copyProperty</span></span> = (dest, source, propName) -&gt;
  info = Object.getOwnPropertyDescriptor source, propName
  <span class="keyword">if</span> info.value?
    info.value = _clone info.value
  Object.defineProperty dest, propName, info</pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <h2>_argsStack</h2>

            </div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <p>Abstraction to wrap global arguments stack. This makes me sad but it is necessary for div -&gt; syntax</p>
<p>  Stack of results</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>_argsStack = []</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p>  Result is top of the stack</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">_argsTop</span></span> = -&gt;
  <span class="keyword">if</span> _argsStack.length
    _argsStack[_argsStack.length-<span class="number">1</span>]
  <span class="keyword">else</span>
    <span class="literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>  Push scope onto arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">_argsPush</span></span> = (args = []) -&gt;
  _argsStack.push args
  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>  Pop scope from arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">_argsPop</span></span> = -&gt;
  <span class="keyword">if</span> _argsStack.length
    <span class="keyword">return</span> _argsStack.pop()
  <span class="literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>  Append argument</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">_argsAppend</span></span> = (arg) -&gt;
  top = oj._argsTop()
  top?.push arg
  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <h2>oj.tag (name, attributes, content, content, ...)</h2>

            </div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">tag</span></span> = (name, args...) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <p><em>name</em>: String of tag to serialize
<em>attributes</em>: (Optional) Object defining attributes of tag being serialized</p>
<p>Styles have smart mappings:</p>
<p><code>c</code>  will map to <code>class</code>
<code>fontSize</code> will map to <code>font-size</code>
<code>borderRadius</code> will map to <code>moz-border-radius</code>, etc.</p>
<p>  Validate input</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">throw</span> <span class="string">'oj.tag error: argument 1 is not a string (expected tag name)'</span> <span class="keyword">unless</span> oj.isString name</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <p>  Build ojml starting with tag</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ojml = [name]</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <p>  Get attributes from args by unioning all objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  attributes = {}
  <span class="keyword">for</span> arg <span class="keyword">in</span> args</pre></div></div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-125">&#182;</a>
              </div>
              <p>  TODO: evaluate argument if necessary</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> oj.isObject arg
      _extend attributes, arg</pre></div></div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-126">&#182;</a>
              </div>
              <p>  Add attributes to ojml if they exist</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ojml.push attributes <span class="keyword">unless</span> _isEmpty attributes</pre></div></div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-127">&#182;</a>
              </div>
              <p>  Push arguments to build up children tags</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  oj._argsPush ojml</pre></div></div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-128">&#182;</a>
              </div>
              <p>  Loop over attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">for</span> arg <span class="keyword">in</span> args
    <span class="keyword">if</span> oj.isObject arg
      <span class="keyword">continue</span>
    <span class="keyword">else</span> <span class="keyword">if</span> oj.isFunction arg

      len = oj._argsTop().length</pre></div></div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-129">&#182;</a>
              </div>
              <p>  Call the argument it will auto append to oj._argsTop() which is ojml</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      r = arg()</pre></div></div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-130">&#182;</a>
              </div>
              <p>  Use return value if oj._argsTop() weren&#39;t changed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> len == oj._argsTop().length <span class="keyword">and</span> r?
        oj._argsAppend r

    <span class="keyword">else</span>
      oj._argsAppend arg</pre></div></div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-131">&#182;</a>
              </div>
              <p>  Pop to restore previous context</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  oj._argsPop()</pre></div></div>
            
        </li>
        
        
        <li id="section-132">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-132">&#182;</a>
              </div>
              <p>  Append the final result to your parent&#39;s arguments
  if there exists an argument to append to</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  oj._argsAppend ojml

  ojml</pre></div></div>
            
        </li>
        
        
        <li id="section-133">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-133">&#182;</a>
              </div>
              <p>  Define all elements as closed or open</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.tag.elements =
  closed: <span class="string">'a abbr acronym address applet article aside audio b bdo big blockquote body button canvas caption center cite code colgroup command datalist dd del details dfn dir div dl dt em embed fieldset figcaption figure font footer form frameset h1 h2 h3 h4 h5 h6 head header hgroup html i iframe ins keygen kbd label legend li map mark menu meter nav noframes noscript object ol optgroup option output p pre progress q rp rt ruby s samp script section select small source span strike strong style sub summary sup table tbody td textarea tfoot th thead time title tr tt u ul var video wbr xmp'</span>.split <span class="string">' '</span>
  open: <span class="string">'area base br col command css !DOCTYPE embed hr img input keygen link meta param source track wbr'</span>.split <span class="string">' '</span></pre></div></div>
            
        </li>
        
        
        <li id="section-134">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-134">&#182;</a>
              </div>
              <p>  Keep track of all valid elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.tag.elements.all = (oj.tag.elements.closed.concat oj.tag.elements.open).sort()</pre></div></div>
            
        </li>
        
        
        <li id="section-135">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-135">&#182;</a>
              </div>
              <p>  Determine if an element is closed or open</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.tag.<span class="function"><span class="title">isClosed</span></span> = (tag) -&gt;
  (_indexOf oj.tag.elements.open, tag, <span class="literal">true</span>) == -<span class="number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-136">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-136">&#182;</a>
              </div>
              <p>  Record tag name on a given tag function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_setTagName</span></span> = (tag, name) -&gt;
  <span class="keyword">if</span> tag?
    tag.tagName = name
  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-137">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-137">&#182;</a>
              </div>
              <p>  Get a tag name on a given tag function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_getTagName</span></span> = (tag) -&gt;
  tag.tagName</pre></div></div>
            
        </li>
        
        
        <li id="section-138">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-138">&#182;</a>
              </div>
              <p>  Record an oj instance on a given element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_setInstanceOnElement</span></span> = (el, inst) -&gt;
  el?.oj = inst
  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-139">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-139">&#182;</a>
              </div>
              <p>  Get a oj instance on a given element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_getInstanceOnElement</span></span> = (el) -&gt;
  <span class="keyword">if</span> el?.oj?
    el.oj
  <span class="keyword">else</span>
    <span class="literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-140">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-140">&#182;</a>
              </div>
              <p>  Create tag methods for all elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">for</span> t <span class="keyword">in</span> oj.tag.elements.all
  <span class="keyword">do</span> (t) -&gt;
    oj[t] = -&gt; oj.tag t, arguments...</pre></div></div>
            
        </li>
        
        
        <li id="section-141">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-141">&#182;</a>
              </div>
              <p>Remember the tag name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _setTagName oj[t], t</pre></div></div>
            
        </li>
        
        
        <li id="section-142">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-142">&#182;</a>
              </div>
              <h2>oj.doctype</h2>

            </div>
            
        </li>
        
        
        <li id="section-143">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-143">&#182;</a>
              </div>
              <p>Method to define doctypes based on short names</p>
<p>  Define helper variables</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>dhp = <span class="string">'HTML PUBLIC "-//W3C//DTD HTML 4.01'</span>
w3 = <span class="string">'"http://www.w3.org/TR/html4/'</span>
strict5 = <span class="string">'html'</span>
strict4 = dhp+<span class="string">'//EN" '</span>+w3+<span class="string">'strict.dtd"'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-144">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-144">&#182;</a>
              </div>
              <p>  Define possible arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>_doctypes =
  <span class="string">'5'</span>: strict5
  <span class="string">'HTML 5'</span>: strict5
  <span class="string">'4'</span>: strict4
  <span class="string">'HTML 4.01 Strict'</span>: strict4
  <span class="string">'HTML 4.01 Frameset'</span>: dhp+<span class="string">' Frameset//EN" '</span>+w3+<span class="string">'frameset.dtd"'</span>
  <span class="string">'HTML 4.01 Transitional'</span>: dhp+<span class="string">' Transitional//EN" '</span>+w3+<span class="string">'loose.dtd"'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-145">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-145">&#182;</a>
              </div>
              <p>  Define the method passing through to !DOCTYPE tag function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">doctype</span></span> = (typeOrValue = <span class="string">'5'</span>) -&gt;
  value = _doctypes[typeOrValue] ? typeOrValue
  oj[<span class="string">'!DOCTYPE'</span>](value)</pre></div></div>
            
        </li>
        
        
        <li id="section-146">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-146">&#182;</a>
              </div>
              <h2>oj.extend (context)</h2>

            </div>
            
        </li>
        
        
        <li id="section-147">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-147">&#182;</a>
              </div>
              <p>Extend all OJ methods into a context. Common contexts are <code>global</code> <code>window</code>
Methods that start with _ are not extended</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">extend</span></span> = (context = root) -&gt;
  o = {}
  <span class="keyword">for</span> k,v <span class="keyword">of</span> oj
    <span class="keyword">if</span> k[<span class="number">0</span>] != <span class="string">'_'</span>
      o[k] = v
  <span class="keyword">delete</span> o.extend
  _extend context, o</pre></div></div>
            
        </li>
        
        
        <li id="section-148">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-148">&#182;</a>
              </div>
              <h2>oj.compile(options, ojml)</h2>

            </div>
            
        </li>
        
        
        <li id="section-149">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-149">&#182;</a>
              </div>
              <p>Compile ojml into meaningful parts</p>
<p>options:</p>
<ul>
<li>html - Compile to html</li>
<li>dom - Compile to dom</li>
<li>css - Compile to css</li>
<li>cssMap - Record css as a javascript object</li>
<li>styles -- Output css as style tags</li>
<li>minify - Minify js and css</li>
<li>ignore:{html:1} - Map of tags to ignore while compiling</li>
</ul>
<p>Define method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">compile</span></span> = (options, ojml) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-150">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-150">&#182;</a>
              </div>
              <p>  Options is optional</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> <span class="keyword">not</span> ojml?
    ojml = options
    options = {}</pre></div></div>
            
        </li>
        
        
        <li id="section-151">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-151">&#182;</a>
              </div>
              <p>Default options to compile everything</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  options = _defaults {}, options,
    html: <span class="literal">true</span>
    dom: <span class="literal">false</span>
    css: <span class="literal">false</span>
    cssMap: <span class="literal">false</span>
    minify: <span class="literal">false</span>
    ignore: {}</pre></div></div>
            
        </li>
        
        
        <li id="section-152">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-152">&#182;</a>
              </div>
              <p>Always ignore oj and css tags</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _extend options.ignore, oj:<span class="number">1</span>, css:<span class="number">1</span>

  acc = _clone options
  acc.html = <span class="keyword">if</span> options.html <span class="keyword">then</span> [] <span class="keyword">else</span> <span class="literal">null</span>    <span class="comment"># html accumulator</span>
  acc.dom = <span class="keyword">if</span> options.dom <span class="keyword">and</span> document? <span class="keyword">then</span> (document.createElement <span class="string">'OJ'</span>) <span class="keyword">else</span> <span class="literal">null</span>
  acc.css = <span class="keyword">if</span> options.css <span class="keyword">or</span> options.cssMap <span class="keyword">then</span> {} <span class="keyword">else</span> <span class="literal">null</span>
  acc.indent = <span class="string">''</span>                                 <span class="comment"># indent counter</span>
  acc.types = [] <span class="keyword">if</span> options.dom                   <span class="comment"># remember types if making dom</span>
  acc.tags = {}                                   <span class="comment"># remember what tags were used</span>
  _compileAny ojml, acc

  <span class="keyword">if</span> acc.css?
    pluginCSSMap = _flattenCSSMap acc.css</pre></div></div>
            
        </li>
        
        
        <li id="section-153">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-153">&#182;</a>
              </div>
              <p>Output cssMap if necessary</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> options.cssMap
    cssMap = pluginCSSMap</pre></div></div>
            
        </li>
        
        
        <li id="section-154">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-154">&#182;</a>
              </div>
              <p>Generate css if necessary</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> options.css
    css = _cssFromPluginObject pluginCSSMap, minify: options.minify, tags:<span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-155">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-155">&#182;</a>
              </div>
              <p>Generate HTML if necessary</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> options.html
    html = acc.html.join <span class="string">''</span></pre></div></div>
            
        </li>
        
        
        <li id="section-156">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-156">&#182;</a>
              </div>
              <p>Generate dom if necessary</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> options.dom</pre></div></div>
            
        </li>
        
        
        <li id="section-157">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-157">&#182;</a>
              </div>
              <p>Remove the <oj> wrapping from the dom element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    dom = acc.dom.childNodes</pre></div></div>
            
        </li>
        
        
        <li id="section-158">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-158">&#182;</a>
              </div>
              <p>Cleanup inconsistencies of childNodes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> dom.length?</pre></div></div>
            
        </li>
        
        
        <li id="section-159">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-159">&#182;</a>
              </div>
              <p>Make dom a real array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      dom = _toArray dom</pre></div></div>
            
        </li>
        
        
        <li id="section-160">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-160">&#182;</a>
              </div>
              <p>Filter out anything that isn&#39;t a dom element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      dom = dom.filter (v) -&gt; oj.isDOM(v)</pre></div></div>
            
        </li>
        
        
        <li id="section-161">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-161">&#182;</a>
              </div>
              <p>Ensure dom is null if empty</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> dom.length == <span class="number">0</span>
      dom = <span class="literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-162">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-162">&#182;</a>
              </div>
              <p>Single elements are returned themselves not as a list
Reasoning: The common cases don&#39;t have multiple elements <html>,<body>
or the complexity doesn&#39;t matter because insertion is abstracted for you
In short it is easier to check for isArray dom, then isArray dom &amp;&amp; dom.length &gt; 0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">else</span> <span class="keyword">if</span> dom.length == <span class="number">1</span>
      dom = dom[<span class="number">0</span>]

  out = html:html, dom:dom, css:css, cssMap:cssMap, types:acc.types, tags:acc.tags

  out</pre></div></div>
            
        </li>
        
        
        <li id="section-163">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-163">&#182;</a>
              </div>
              <h2>_styleFromObject:</h2>

            </div>
            
        </li>
        
        
        <li id="section-164">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-164">&#182;</a>
              </div>
              <p>Convert object to string form</p>
<pre><code>inline:false      inline:true                inline:false,indent:&#39;\t&#39;
color:red;        color:red;font-size:10px   \tcolor:red;
font-size:10px;                              \tfont-size:10px;</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_styleFromObject</span></span> = (obj, options = {}) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-165">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-165">&#182;</a>
              </div>
              <p>  Default options</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _defaults options,
    inline: <span class="literal">true</span>
    indent: <span class="string">''</span></pre></div></div>
            
        </li>
        
        
        <li id="section-166">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-166">&#182;</a>
              </div>
              <p>  Trailing semi should only exist on when we aren&#39;t indenting</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  options.semi = !options.inline
  out = <span class="string">""</span></pre></div></div>
            
        </li>
        
        
        <li id="section-167">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-167">&#182;</a>
              </div>
              <p>  Sort keys to create consistent output</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  keys = _keys(obj).sort()</pre></div></div>
            
        </li>
        
        
        <li id="section-168">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-168">&#182;</a>
              </div>
              <p>  Support indention and inlining</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  indent = options.indent ? <span class="string">''</span>
  newline = <span class="keyword">if</span> options.inline <span class="keyword">then</span> <span class="string">''</span> <span class="keyword">else</span> <span class="string">'\n'</span>

  <span class="keyword">for</span> kFancy,ix <span class="keyword">in</span> keys</pre></div></div>
            
        </li>
        
        
        <li id="section-169">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-169">&#182;</a>
              </div>
              <p>  Add semi if it is not inline or it is not the last key</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    semi = <span class="keyword">if</span> options.semi <span class="keyword">or</span> ix != keys.length-<span class="number">1</span> <span class="keyword">then</span> <span class="string">";"</span> <span class="keyword">else</span> <span class="string">''</span></pre></div></div>
            
        </li>
        
        
        <li id="section-170">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-170">&#182;</a>
              </div>
              <p>  Allow keys to be camal case</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    k = _dasherize kFancy</pre></div></div>
            
        </li>
        
        
        <li id="section-171">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-171">&#182;</a>
              </div>
              <p>  Collect css result for this key</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    out += <span class="string">"<span class="subst">#{indent}</span><span class="subst">#{k}</span>:<span class="subst">#{obj[kFancy]}</span><span class="subst">#{semi}</span><span class="subst">#{newline}</span>"</span>

  out</pre></div></div>
            
        </li>
        
        
        <li id="section-172">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-172">&#182;</a>
              </div>
              <h2>_attributesFromObject: Convert object to attribute string</h2>

            </div>
            
        </li>
        
        
        <li id="section-173">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-173">&#182;</a>
              </div>
              <p>This object has nothing special. No renamed keys, no jquery events. It is
precicely what must be serialized with no adjustment.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_attributesFromObject</span></span> = (obj) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-174">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-174">&#182;</a>
              </div>
              <p>Pass through non objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">return</span> obj <span class="keyword">if</span> <span class="keyword">not</span> oj.isObject obj

  out = <span class="string">''</span></pre></div></div>
            
        </li>
        
        
        <li id="section-175">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-175">&#182;</a>
              </div>
              <p>Serialize attributes in order for consistent output</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  space = <span class="string">''</span>
  <span class="keyword">for</span> k <span class="keyword">in</span> _keys(obj).sort()
    v = obj[k]</pre></div></div>
            
        </li>
        
        
        <li id="section-176">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-176">&#182;</a>
              </div>
              <p>Boolean attributes have no value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (v == <span class="literal">true</span>)
      out += <span class="string">"<span class="subst">#{space}</span><span class="subst">#{k}</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-177">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-177">&#182;</a>
              </div>
              <p>Other attributes have a value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">else</span>
      out += <span class="string">"<span class="subst">#{space}</span><span class="subst">#{k}</span>=\"<span class="subst">#{v}</span>\""</span>

    space = <span class="string">' '</span>
  out</pre></div></div>
            
        </li>
        
        
        <li id="section-178">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-178">&#182;</a>
              </div>
              <h2>_flattenCSSMap</h2>

            </div>
            
        </li>
        
        
        <li id="section-179">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-179">&#182;</a>
              </div>
              <p>Take an OJ object definition of CSS and simplify it to the form:
<code>&#39;plugin&#39; -&gt; &#39;@media query&#39; -&gt; &#39;selector&#39; -&gt;&#39;rulesMap&#39;</code></p>
<p>This method vastly simplifies <code>_cssFromPluginObject</code></p>
<p>Nested definitions, media definitions and comma definitions are resolved.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_flattenCSSMap</span></span> = (cssMap) -&gt;
  flatMap = {}
  <span class="keyword">for</span> plugin,cssMap_ <span class="keyword">of</span> cssMap
    _flattenCSSMap_ cssMap_, flatMap, [<span class="string">''</span>], [<span class="string">''</span>], plugin
  flatMap</pre></div></div>
            
        </li>
        
        
        <li id="section-180">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-180">&#182;</a>
              </div>
              <p>  Recursive helper with accumulators for flatMap (output)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_flattenCSSMap_</span></span> = (cssMap, flatMapAcc, selectorsAcc, mediasAcc, plugin) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-181">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-181">&#182;</a>
              </div>
              <p>  Built in media helpers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  medias =
    <span class="string">'widescreen'</span>: <span class="string">'only screen and (min-width: 1200px)'</span>
    <span class="string">'monitor'</span>: <span class="string">''</span> <span class="comment"># Monitor is the default</span>
    <span class="string">'tablet'</span>: <span class="string">'only screen and (min-width: 768px) and (max-width: 959px)'</span>
    <span class="string">'phone'</span>: <span class="string">'only screen and (max-width: 767px)'</span>

  <span class="keyword">for</span> selector, rules <span class="keyword">of</span> cssMap</pre></div></div>
            
        </li>
        
        
        <li id="section-182">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-182">&#182;</a>
              </div>
              <p>  (1) Recursive Case: Recurse on <code>rules</code> when it is an object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> <span class="keyword">typeof</span> rules == <span class="string">'object'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-183">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-183">&#182;</a>
              </div>
              <p>  (1a) Media Query found: Generate the next media queries</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> selector.indexOf(<span class="string">'@media'</span>) == <span class="number">0</span>

        selectorsNext = selectorsAcc
        selector = (selector.slice <span class="string">'@media'</span>.length).trim()</pre></div></div>
            
        </li>
        
        
        <li id="section-184">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-184">&#182;</a>
              </div>
              <p>  Media queries can be comma seperated</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        mediaParts = _splitAndTrim selector, <span class="string">','</span></pre></div></div>
            
        </li>
        
        
        <li id="section-185">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-185">&#182;</a>
              </div>
              <p>  Substitute convience media query methods</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        mediaParts = oj._map mediaParts, (v) -&gt;
          <span class="keyword">if</span> medias[v]? <span class="keyword">then</span> medias[v] <span class="keyword">else</span> v</pre></div></div>
            
        </li>
        
        
        <li id="section-186">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-186">&#182;</a>
              </div>
              <p>  Calculate the next media queries</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        mediasNext = []
        <span class="keyword">for</span> mediaOuter <span class="keyword">in</span> mediasAcc
          <span class="keyword">for</span> mediaInner <span class="keyword">in</span> mediaParts

            mediaCur = mediaInner
            <span class="keyword">if</span> (mediaInner.indexOf <span class="string">'&amp;'</span>) == -<span class="number">1</span> <span class="keyword">and</span> mediaOuter != <span class="string">''</span>
              mediaCur = <span class="string">"&amp; and <span class="subst">#{mediaInner}</span>"</span>

            mediasNext.push mediaCur.replace(<span class="regexp">/&amp;/g</span>, mediaOuter)</pre></div></div>
            
        </li>
        
        
        <li id="section-187">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-187">&#182;</a>
              </div>
              <p>  (1b) Selector Found: Generate the next selectors</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">else</span>
        mediasNext = mediasAcc</pre></div></div>
            
        </li>
        
        
        <li id="section-188">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-188">&#182;</a>
              </div>
              <p>  Selectors can be comma seperated</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        selectorParts = _splitAndTrim selector, <span class="string">','</span></pre></div></div>
            
        </li>
        
        
        <li id="section-189">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-189">&#182;</a>
              </div>
              <p>  Generate the next selectors and substitue <code>&amp;</code> when present
  TODO: Refactor to use the same code as media queries</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        selectorsNext = []
        <span class="keyword">for</span> selOuter <span class="keyword">in</span> selectorsAcc
          <span class="keyword">for</span> selInner <span class="keyword">in</span> selectorParts</pre></div></div>
            
        </li>
        
        
        <li id="section-190">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-190">&#182;</a>
              </div>
              <p>  When <code>&amp;</code> is not present just insert in front with a space</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            selCur = selInner
            <span class="keyword">if</span> (selInner.indexOf <span class="string">'&amp;'</span>) == -<span class="number">1</span> <span class="keyword">and</span> selOuter != <span class="string">''</span>
              selCur = <span class="string">"&amp; <span class="subst">#{selInner}</span>"</span>

            selectorsNext.push selCur.replace(<span class="regexp">/&amp;/g</span>, selOuter)</pre></div></div>
            
        </li>
        
        
        <li id="section-191">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-191">&#182;</a>
              </div>
              <p>  Recurse through objects after calculating the next selectors</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      _flattenCSSMap_ rules, flatMapAcc, selectorsNext, mediasNext, plugin</pre></div></div>
            
        </li>
        
        
        <li id="section-192">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-192">&#182;</a>
              </div>
              <p>  (2) Base Case: Record our selector when <code>rules</code> is a value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">else</span>
      selectorWithCommas = selectorsAcc.sort().join <span class="string">','</span>

      mediaWithAnds = mediasAcc.sort().join <span class="string">','</span>
      mediaWithAnds = <span class="string">"@media "</span> + mediaWithAnds <span class="keyword">unless</span> mediaWithAnds == <span class="string">''</span></pre></div></div>
            
        </li>
        
        
        <li id="section-193">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-193">&#182;</a>
              </div>
              <p>  Record the rule deeply in <code>flatMapAcc</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      _setObject flatMapAcc, plugin, mediaWithAnds, selectorWithCommas, selector, rules

  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-194">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-194">&#182;</a>
              </div>
              <h2>_styleClassFromPlugin:</h2>

            </div>
            
        </li>
        
        
        <li id="section-195">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-195">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_styleClassFromPlugin</span></span> = (plugin) -&gt;
  <span class="string">"<span class="subst">#{plugin}</span>-style"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-196">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-196">&#182;</a>
              </div>
              <h2>_styleTagFromMediaObject:</h2>

            </div>
            
        </li>
        
        
        <li id="section-197">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-197">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">_styleTagFromMediaObject</span></span> = (plugin, mediaMap, options) -&gt;
  newline = <span class="keyword">if</span> options?.minify <span class="keyword">then</span> <span class="string">''</span> <span class="keyword">else</span> <span class="string">'\n'</span>
  css = _cssFromMediaObject mediaMap, options
  <span class="string">"&lt;style class=\"<span class="subst">#{_styleClassFromPlugin plugin}</span>\"&gt;<span class="subst">#{newline}</span><span class="subst">#{css}</span>&lt;/style&gt;"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-198">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-198">&#182;</a>
              </div>
              <h2>_cssFromMediaObject:</h2>

            </div>
            
        </li>
        
        
        <li id="section-199">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-199">&#182;</a>
              </div>
              <p>Convert css from a flattened rule object. The rule object is of the form:
mediaQuery =&gt; selector =&gt; rulesObject</p>
<p>Placeholder functions for server side minification</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">_minifyJS</span></span> = (js,options) -&gt; js
oj.<span class="function"><span class="title">_minifyCSS</span></span> = (css,options) -&gt; css

<span class="function"><span class="title">_cssFromMediaObject</span></span> = (mediaMap, options = {}) -&gt;

  minify = options.minify ? <span class="number">0</span>
  tags = options.tags ? <span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-200">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-200">&#182;</a>
              </div>
              <p>  Deterine what output characters are needed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  newline = <span class="keyword">if</span> minify <span class="keyword">then</span> <span class="string">''</span> <span class="keyword">else</span> <span class="string">'\n'</span>
  space = <span class="keyword">if</span> minify <span class="keyword">then</span> <span class="string">''</span> <span class="keyword">else</span> <span class="string">' '</span>
  inline = minify</pre></div></div>
            
        </li>
        
        
        <li id="section-201">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-201">&#182;</a>
              </div>
              <p>  Build css for media =&gt; selector =&gt;  rules</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  css = <span class="string">''</span>
  <span class="keyword">for</span> media, selectorMap <span class="keyword">of</span> mediaMap</pre></div></div>
            
        </li>
        
        
        <li id="section-202">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-202">&#182;</a>
              </div>
              <p>  Serialize media query</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> media
      media = media.replace <span class="regexp">/,/g</span>, <span class="string">",<span class="subst">#{space}</span>"</span>
      css += <span class="string">"<span class="subst">#{media}</span><span class="subst">#{space}</span>{<span class="subst">#{newline}</span>"</span>

    <span class="keyword">for</span> selector,styles <span class="keyword">of</span> selectorMap
      indent = <span class="keyword">if</span> (!minify) <span class="keyword">and</span> media <span class="keyword">then</span> <span class="string">'\t'</span> <span class="keyword">else</span> <span class="string">''</span></pre></div></div>
            
        </li>
        
        
        <li id="section-203">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-203">&#182;</a>
              </div>
              <p>  Serialize selector</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      selector = selector.replace <span class="regexp">/,/g</span>, <span class="string">",<span class="subst">#{newline}</span>"</span>
      css += <span class="string">"<span class="subst">#{indent}</span><span class="subst">#{selector}</span><span class="subst">#{space}</span>{<span class="subst">#{newline}</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-204">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-204">&#182;</a>
              </div>
              <p>  Serialize style rules</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      indentRule = <span class="keyword">if</span> (!minify) <span class="keyword">then</span> indent + <span class="string">'\t'</span> <span class="keyword">else</span> indent

      rules = _styleFromObject styles, inline:inline, indent:indentRule
      css += rules + indent + <span class="string">'}'</span> + newline</pre></div></div>
            
        </li>
        
        
        <li id="section-205">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-205">&#182;</a>
              </div>
              <p>  End media query</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> media != <span class="string">''</span>
      css += <span class="string">'}'</span> + newline
  <span class="keyword">try</span>
    css = oj._minifyCSS css, options
  <span class="keyword">catch</span> eCSS
    <span class="keyword">throw</span> <span class="keyword">new</span> Error <span class="string">"css minification error: <span class="subst">#{eCSS.message}</span>\nCould not minify:\n<span class="subst">#{css}</span>"</span>

  css</pre></div></div>
            
        </li>
        
        
        <li id="section-206">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-206">&#182;</a>
              </div>
              <h2>_cssFromPluginObject:</h2>

            </div>
            
        </li>
        
        
        <li id="section-207">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-207">&#182;</a>
              </div>
              <p>Convert flattened css selectors and rules to a string. Plugin objects are of the form:
pluginName =&gt; mediaQuery =&gt; selector =&gt; rulesObject</p>
<p>Supports nested objections, comma seperated rules, and @media queries</p>
<p>minify:false will output newlines
tags:true will output the css in <code>&lt;style&gt;</code> tags</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_cssFromPluginObject</span></span> = (flatCSSMap, options = {}) -&gt;

  minify = options.minify ? <span class="number">0</span>
  tags = options.tags ? <span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-208">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-208">&#182;</a>
              </div>
              <p>  Deterine what output characters are needed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  newline = <span class="keyword">if</span> minify <span class="keyword">then</span> <span class="string">''</span> <span class="keyword">else</span> <span class="string">'\n'</span>
  space = <span class="keyword">if</span> minify <span class="keyword">then</span> <span class="string">''</span> <span class="keyword">else</span> <span class="string">' '</span>
  inline = minify

  css = <span class="string">''</span>
  <span class="keyword">for</span> plugin, mediaMap <span class="keyword">of</span> flatCSSMap
    <span class="keyword">if</span> tags
      css += <span class="string">"&lt;style class=\"<span class="subst">#{plugin}</span>-style\"&gt;<span class="subst">#{newline}</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-209">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-209">&#182;</a>
              </div>
              <p>  Serialize CSS with potential minification</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    css += _cssFromMediaObject mediaMap, options

    <span class="keyword">if</span> tags
      css += <span class="string">"<span class="subst">#{newline}</span>&lt;/style&gt;<span class="subst">#{newline}</span>"</span>

  css</pre></div></div>
            
        </li>
        
        
        <li id="section-210">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-210">&#182;</a>
              </div>
              <h2>_compileDeeper</h2>

            </div>
            
        </li>
        
        
        <li id="section-211">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-211">&#182;</a>
              </div>
              <p>Recursive helper for compiling that wraps indention</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_compileDeeper</span></span> = (method, ojml, options) -&gt;
  i = options.indent
  options.indent += <span class="string">'\t'</span>
  method ojml, options
  options.indent = i</pre></div></div>
            
        </li>
        
        
        <li id="section-212">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-212">&#182;</a>
              </div>
              <h2>_compileAny</h2>

            </div>
            
        </li>
        
        
        <li id="section-213">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-213">&#182;</a>
              </div>
              <p>Recursive helper for compiling any type</p>
<p>Compile ojml or any type</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">pass</span></span> = -&gt;
<span class="function"><span class="title">_compileAny</span></span> = (ojml, options) -&gt;

  <span class="keyword">switch</span> oj.typeOf ojml

    <span class="keyword">when</span> <span class="string">'array'</span>
      _compileTag ojml, options

    <span class="keyword">when</span> <span class="string">'jquery'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-214">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-214">&#182;</a>
              </div>
              <p>TODO: Missing unit tests for the jquery case</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      options.html?.push ojml.html()
      options.dom?.concat ojml.get()

    <span class="keyword">when</span> <span class="string">'string'</span>
      options.html?.push ojml
      <span class="keyword">if</span> ojml.length &gt; <span class="number">0</span> <span class="keyword">and</span> ojml[<span class="number">0</span>] == <span class="string">'&lt;'</span>
        root = document.createElement <span class="string">'div'</span>
        root.innerHTML = ojml
        els = root.childNodes
        options.dom?.appendChild root</pre></div></div>
            
        </li>
        
        
        <li id="section-215">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-215">&#182;</a>
              </div>
              <p>for el in els
  options.dom?.appendChild el</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">else</span>
        options.dom?.appendChild document.createTextNode ojml

    <span class="keyword">when</span> <span class="string">'boolean'</span>, <span class="string">'number'</span>
      options.html?.push <span class="string">"<span class="subst">#{ojml}</span>"</span>
      options.dom?.appendChild document.createTextNode <span class="string">"<span class="subst">#{ojml}</span>"</span>

    <span class="keyword">when</span> <span class="string">'function'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-216">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-216">&#182;</a>
              </div>
              <p>Wrap function call to allow full oj generation within ojml</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      _compileAny (oj ojml), options

    <span class="keyword">when</span> <span class="string">'date'</span>
      options.html?.push <span class="string">"<span class="subst">#{ojml.toLocaleString()}</span>"</span>
      options.dom?.appendChild document.createTextNode <span class="string">"<span class="subst">#{ojml.toLocaleString()}</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-217">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-217">&#182;</a>
              </div>
              <p>Do nothing for &#39;null&#39;, &#39;undefined&#39;, &#39;object&#39;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">when</span> <span class="string">'null'</span> <span class="keyword">then</span> <span class="keyword">break</span>
    <span class="keyword">when</span> <span class="string">'undefined'</span> <span class="keyword">then</span> <span class="keyword">break</span>
    <span class="keyword">when</span> <span class="string">'object'</span> <span class="keyword">then</span> <span class="keyword">break</span>

    <span class="keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-218">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-218">&#182;</a>
              </div>
              <p>OJ type</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> oj.isOJ ojml
        options.types?.push ojml
        options.html?.push ojml.toHTML(options)
        options.dom?.appendChild ojml.toDOM(options)
        <span class="keyword">if</span> options.css?
          _extend options.css, ojml.toCSSMap(options)

  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-219">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-219">&#182;</a>
              </div>
              <h2>_compileTag</h2>

            </div>
            
        </li>
        
        
        <li id="section-220">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-220">&#182;</a>
              </div>
              <p>Recursive helper for compiling ojml tags</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_compileTag</span></span> = (ojml, options) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-221">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-221">&#182;</a>
              </div>
              <p>  Empty list compiles to undefined</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">return</span> <span class="keyword">if</span> ojml.length == <span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-222">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-222">&#182;</a>
              </div>
              <p>  Get tag name, allowing the tag parameter to be &#39;table&#39; (tag name) or table (function) or Table (object)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  tag = ojml[<span class="number">0</span>]
  tagType = <span class="keyword">typeof</span> tag
  tag = <span class="keyword">if</span> (tagType == <span class="string">'function'</span> <span class="keyword">or</span> tagType == <span class="string">'object'</span>) <span class="keyword">and</span> _getTagName(tag)? <span class="keyword">then</span> _getTagName(tag) <span class="keyword">else</span> tag
  <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'oj.compile: tag name is missing'</span>) <span class="keyword">unless</span> oj.isString(tag) <span class="keyword">and</span> tag.length &gt; <span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-223">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-223">&#182;</a>
              </div>
              <p>  Record tag as encountered</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  options.tags[tag] = <span class="literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-224">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-224">&#182;</a>
              </div>
              <p>  Instance oj object if tag is capitalized</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> _isCapitalLetter tag[<span class="number">0</span>]
    <span class="keyword">return</span> _compileDeeper _compileAny, (<span class="keyword">new</span> oj[tag] ojml.slice(<span class="number">1</span>)), options</pre></div></div>
            
        </li>
        
        
        <li id="section-225">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-225">&#182;</a>
              </div>
              <p>  Gather attributes if present</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  attributes = <span class="literal">null</span>
  <span class="keyword">if</span> oj.isObject ojml[<span class="number">1</span>]
    attributes = ojml[<span class="number">1</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-226">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-226">&#182;</a>
              </div>
              <p>  Gather children if present</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  children = <span class="keyword">if</span> attributes <span class="keyword">then</span> ojml.slice <span class="number">2</span> <span class="keyword">else</span> ojml.slice <span class="number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-227">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-227">&#182;</a>
              </div>
              <p>  Compile to css if requested</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> options.css <span class="keyword">and</span> tag == <span class="string">'css'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-228">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-228">&#182;</a>
              </div>
              <p>Extend options.css with rules</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">for</span> selector,styles <span class="keyword">of</span> attributes
      options.css[<span class="string">'oj'</span>] ?= {}
      options.css[<span class="string">'oj'</span>][selector] ?= {}
      _extend options.css[<span class="string">'oj'</span>][selector], styles</pre></div></div>
            
        </li>
        
        
        <li id="section-229">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-229">&#182;</a>
              </div>
              <p>  Compile DOCTYPE as special case because it is not really an element
  It has attributes with spaces and cannot be created by dom manipulation
  In this way it is HTML generation only.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> tag == <span class="string">'!DOCTYPE'</span>
    <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'oj.compile: doctype expects string as first argument'</span>) <span class="keyword">unless</span> oj.isString ojml[<span class="number">1</span>]
    <span class="keyword">if</span> <span class="keyword">not</span> options.ignore[tag]
      <span class="keyword">if</span> options.html
        options.html.push <span class="string">"&lt;<span class="subst">#{tag}</span> <span class="subst">#{ojml[<span class="number">1</span>]}</span>&gt;"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-230">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-230">&#182;</a>
              </div>
              <p>options.dom is purposely ignored</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">return</span>

  <span class="keyword">if</span> <span class="keyword">not</span> options.ignore[tag]

    events = _attributesProcessedForOJ attributes</pre></div></div>
            
        </li>
        
        
        <li id="section-231">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-231">&#182;</a>
              </div>
              <p>  Compile to dom if requested</p>
<p>Add dom element with attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> options.dom <span class="keyword">and</span> document?</pre></div></div>
            
        </li>
        
        
        <li id="section-232">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-232">&#182;</a>
              </div>
              <p>Create element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      el = document.createElement tag</pre></div></div>
            
        </li>
        
        
        <li id="section-233">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-233">&#182;</a>
              </div>
              <p>Add self to parent</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> oj.isDOMElement options.dom
        options.dom.appendChild el</pre></div></div>
            
        </li>
        
        
        <li id="section-234">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-234">&#182;</a>
              </div>
              <p>Push ourselves on the dom stack (to handle children)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      options.dom = el</pre></div></div>
            
        </li>
        
        
        <li id="section-235">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-235">&#182;</a>
              </div>
              <p>Set attributes in sorted order for consistency</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> oj.isObject attributes
        <span class="keyword">for</span> attrName <span class="keyword">in</span> _keys(attributes).sort()
          attrValue = attributes[attrName]</pre></div></div>
            
        </li>
        
        
        <li id="section-236">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-236">&#182;</a>
              </div>
              <p>Boolean attributes have no value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">if</span> attrValue == <span class="literal">true</span>
            att = document.createAttribute attrName
            el.setAttributeNode att
          <span class="keyword">else</span>
            el.setAttribute attrName, attrValue</pre></div></div>
            
        </li>
        
        
        <li id="section-237">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-237">&#182;</a>
              </div>
              <p>Bind events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      _attributesBindEventsToDOM events, el</pre></div></div>
            
        </li>
        
        
        <li id="section-238">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-238">&#182;</a>
              </div>
              <p>  Compile to html if requested</p>
<p>Add tag with attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> options.html
      attr = (_attributesFromObject attributes) ? <span class="string">''</span>
      space = <span class="keyword">if</span> attr == <span class="string">''</span> <span class="keyword">then</span> <span class="string">''</span> <span class="keyword">else</span> <span class="string">' '</span>
      options.html.push <span class="string">"&lt;<span class="subst">#{tag}</span><span class="subst">#{space}</span><span class="subst">#{attr}</span>&gt;"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-239">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-239">&#182;</a>
              </div>
              <p>  Recurse through children if this tag isn&#39;t ignored deeply</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> options.ignore[tag] != <span class="string">'deep'</span>
    <span class="keyword">for</span> child <span class="keyword">in</span> children</pre></div></div>
            
        </li>
        
        
        <li id="section-240">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-240">&#182;</a>
              </div>
              <p>Skip indention if there is only one child</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> !options.minify <span class="keyword">and</span> children.length &gt; <span class="number">1</span>
        options.html?.push <span class="string">"\n\t<span class="subst">#{options.indent}</span>"</span>
      _compileDeeper _compileAny, child, options</pre></div></div>
            
        </li>
        
        
        <li id="section-241">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-241">&#182;</a>
              </div>
              <p>Skip indention if there is only one child</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> (!options.minify) <span class="keyword">and</span> children.length &gt; <span class="number">1</span>
    options.html?.push <span class="string">"\n<span class="subst">#{options.indent}</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-242">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-242">&#182;</a>
              </div>
              <p>  End html tag if you have children or your tag closes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> <span class="keyword">not</span> options.ignore[tag]</pre></div></div>
            
        </li>
        
        
        <li id="section-243">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-243">&#182;</a>
              </div>
              <p>Close tag if html</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> options.html <span class="keyword">and</span> (children.length &gt; <span class="number">0</span> <span class="keyword">or</span> oj.tag.isClosed(tag))
      options.html?.push <span class="string">"&lt;/<span class="subst">#{tag}</span>&gt;"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-244">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-244">&#182;</a>
              </div>
              <p>Pop ourselves if dom</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> options.dom
      options.dom = options.dom.parentNode

  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-245">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-245">&#182;</a>
              </div>
              <p>Allow attributes to take style as an object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_attributeStyleAllowsObject</span></span> = (attr) -&gt;
  <span class="keyword">if</span> oj.isObject attr?.style
    attr.style = _styleFromObject attr.style, inline:<span class="literal">true</span>
  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-246">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-246">&#182;</a>
              </div>
              <p>Allow attributes to alias c to class and use arrays instead of space seperated strings</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_attributeCMeansClassAndAllowsArrays</span></span> = (attr) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-247">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-247">&#182;</a>
              </div>
              <p>Convert to c and class from arrays to strings</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> oj.isArray(attr?.c)
    attr.c = attr.c.join <span class="string">' '</span>
  <span class="keyword">if</span> oj.isArray(attr?.class)
    attr.<span class="class"><span class="keyword">class</span> = <span class="title">attr</span>.<span class="title">class</span>.<span class="title">join</span> ' '</span></pre></div></div>
            
        </li>
        
        
        <li id="section-248">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-248">&#182;</a>
              </div>
              <p>Move c to class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> attr?.c?
    <span class="keyword">if</span> attr?.class?
      attr.<span class="class"><span class="keyword">class</span> += ' ' + <span class="title">attr</span>.<span class="title">c</span></span>
    <span class="keyword">else</span>
      attr.<span class="class"><span class="keyword">class</span> = <span class="title">attr</span>.<span class="title">c</span></span>
    <span class="keyword">delete</span> attr.c
  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-249">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-249">&#182;</a>
              </div>
              <p>Omit falsy values except for zero</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_attributeOmitFalsyValues</span></span> = (attr) -&gt;
  <span class="keyword">if</span> oj.isObject attr</pre></div></div>
            
        </li>
        
        
        <li id="section-250">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-250">&#182;</a>
              </div>
              <p>Filter out falsy except for 0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">for</span> k,v <span class="keyword">of</span> attr
      <span class="keyword">delete</span> attr[k] <span class="keyword">if</span> v == <span class="literal">null</span> <span class="keyword">or</span> v == <span class="literal">undefined</span> <span class="keyword">or</span> v == <span class="literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-251">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-251">&#182;</a>
              </div>
              <p>Supported events from jquery</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>jqueryEvents = bind:<span class="number">1</span>, <span class="literal">on</span>:<span class="number">1</span>, <span class="literal">off</span>:<span class="number">1</span>, live:<span class="number">1</span>, blur:<span class="number">1</span>, change:<span class="number">1</span>, click:<span class="number">1</span>, dblclick:<span class="number">1</span>, focus:<span class="number">1</span>, focusin:<span class="number">1</span>, focusout:<span class="number">1</span>, hover:<span class="number">1</span>, keydown:<span class="number">1</span>, keypress:<span class="number">1</span>, keyup:<span class="number">1</span>, mousedown:<span class="number">1</span>, mouseenter:<span class="number">1</span>, mouseleave:<span class="number">1</span>, mousemove:<span class="number">1</span>, mouseout:<span class="number">1</span>, mouseup:<span class="number">1</span>, ready:<span class="number">1</span>, resize:<span class="number">1</span>, scroll:<span class="number">1</span>, select:<span class="number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-252">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-252">&#182;</a>
              </div>
              <p>Filter out jquery events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_attributesFilterOutEvents</span></span> = (attr) -&gt;
  out = {}
  <span class="keyword">if</span> oj.isObject attr</pre></div></div>
            
        </li>
        
        
        <li id="section-253">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-253">&#182;</a>
              </div>
              <p>Filter out attributes that are jqueryEvents</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">for</span> k,v <span class="keyword">of</span> attr</pre></div></div>
            
        </li>
        
        
        <li id="section-254">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-254">&#182;</a>
              </div>
              <p>If this attribute (k) is an event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> jqueryEvents[k]?
        out[k] = v
        <span class="keyword">delete</span> attr[k]
  out</pre></div></div>
            
        </li>
        
        
        <li id="section-255">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-255">&#182;</a>
              </div>
              <p>All the OJ magic for attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_attributesProcessedForOJ</span></span> = (attr) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-256">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-256">&#182;</a>
              </div>
              <p>Alias c to class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _attributeCMeansClassAndAllowsArrays attr</pre></div></div>
            
        </li>
        
        
        <li id="section-257">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-257">&#182;</a>
              </div>
              <p>style takes objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _attributeStyleAllowsObject attr</pre></div></div>
            
        </li>
        
        
        <li id="section-258">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-258">&#182;</a>
              </div>
              <p>Omit keys that false, null, or undefined</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _attributeOmitFalsyValues attr</pre></div></div>
            
        </li>
        
        
        <li id="section-259">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-259">&#182;</a>
              </div>
              <p>TODO: Consider jsoning anything that isn&#39;t a string
any keys that aren&#39;t strings are jsoned
_attributesJSONAllKeys attributes</p>
<p>Filter out jquery events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  events = _attributesFilterOutEvents attr</pre></div></div>
            
        </li>
        
        
        <li id="section-260">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-260">&#182;</a>
              </div>
              <p>Returns bindable events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  events</pre></div></div>
            
        </li>
        
        
        <li id="section-261">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-261">&#182;</a>
              </div>
              <p>Bind events to dom</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_attributesBindEventsToDOM</span></span> = (events, el) -&gt;
  <span class="keyword">for</span> ek, ev <span class="keyword">of</span> events
    <span class="keyword">if</span> $?
      <span class="keyword">if</span> oj.isArray ev
        $(el)[ek].apply @, ev
      <span class="keyword">else</span>
        $(el)[ek](ev)
    <span class="keyword">else</span>
      console.error <span class="string">"oj: jquery is missing when binding a '<span class="subst">#{ek}</span>' event"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-262">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-262">&#182;</a>
              </div>
              <h2>oj.toHTML</h2>

            </div>
            
        </li>
        
        
        <li id="section-263">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-263">&#182;</a>
              </div>
              <p>Make ojml directly to HTML ignoring event bindings and css.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">toHTML</span></span> = (options, ojml) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-264">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-264">&#182;</a>
              </div>
              <p>Options is optional</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> <span class="keyword">not</span> oj.isObject options
    ojml = options
    options = {}</pre></div></div>
            
        </li>
        
        
        <li id="section-265">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-265">&#182;</a>
              </div>
              <p>Create html only</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _extend options, dom:<span class="number">0</span>, js:<span class="number">0</span>, html:<span class="number">1</span>, css:<span class="number">0</span>
  (oj.compile options, ojml).html</pre></div></div>
            
        </li>
        
        
        <li id="section-266">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-266">&#182;</a>
              </div>
              <h2>oj.toCSS</h2>

            </div>
            
        </li>
        
        
        <li id="section-267">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-267">&#182;</a>
              </div>
              <p>Compile ojml directly to css ignoring event bindings and html.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">toCSS</span></span> = (options, ojml) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-268">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-268">&#182;</a>
              </div>
              <p>Options is optional</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> <span class="keyword">not</span> oj.isObject options
    ojml = options
    options = {}</pre></div></div>
            
        </li>
        
        
        <li id="section-269">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-269">&#182;</a>
              </div>
              <p>Create css only</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _extend options, dom:<span class="number">0</span>, js:<span class="number">0</span>, html:<span class="number">0</span>, css:<span class="number">1</span>
  (oj.compile options, ojml).css</pre></div></div>
            
        </li>
        
        
        <li id="section-270">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-270">&#182;</a>
              </div>
              <h2>_inherit</h2>

            </div>
            
        </li>
        
        
        <li id="section-271">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-271">&#182;</a>
              </div>
              <p>Based on, but sadly incompatable with, coffeescript inheritance</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_inherit</span></span> = (child, parent) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-272">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-272">&#182;</a>
              </div>
              <p>Copy class properties and methods</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">for</span> key <span class="keyword">of</span> parent
    oj.copyProperty child, parent, key

  <span class="function"><span class="title">ctor</span></span> = -&gt;
  ctor:: = parent::
  child:: = <span class="keyword">new</span> ctor()</pre></div></div>
            
        </li>
        
        
        <li id="section-273">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-273">&#182;</a>
              </div>
              <p>Provide easy access for base class methods
Example: Parent.base.methodName(arguments...)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  child.base = parent::

  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-274">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-274">&#182;</a>
              </div>
              <h2>oj.argumentShift</h2>

            </div>
            
        </li>
        
        
        <li id="section-275">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-275">&#182;</a>
              </div>
              <p>Helper to make argument handling easier</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">argumentShift</span></span> = (args, key) -&gt;
  <span class="keyword">if</span> (oj.isObject args) <span class="keyword">and</span> key? <span class="keyword">and</span> args[key]?
    value = args[key]
    <span class="keyword">delete</span> args[key]
  value</pre></div></div>
            
        </li>
        
        
        <li id="section-276">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-276">&#182;</a>
              </div>
              <h2>oj.createType</h2>

            </div>
            
        </li>
        
        
        <li id="section-277">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-277">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">createType</span></span> = (name, args = {}) -&gt;
  <span class="keyword">throw</span> <span class="string">'oj.createType: string expected for first argument'</span> <span class="keyword">unless</span> oj.isString name
  <span class="keyword">throw</span> <span class="string">'oj.createType: object expected for second argument'</span> <span class="keyword">unless</span> oj.isObject args

  args.methods ?= {}
  args.properties ?= {}</pre></div></div>
            
        </li>
        
        
        <li id="section-278">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-278">&#182;</a>
              </div>
              <p>When auto newing you need to delay construct the properties
or they will be constructed twice.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  delay = <span class="string">'__DELAYED__'</span>
  Out = <span class="keyword">new</span> Function(<span class="string">"""return function <span class="subst">#{name}</span>(){
    var _this = this;
    if ( !(this instanceof <span class="subst">#{name}</span>) ) {
      _this = new <span class="subst">#{name}</span>('<span class="subst">#{delay}</span>');
      _this.__autonew__ = true;
    }

    if (arguments &amp;&amp; arguments[0] != '<span class="subst">#{delay}</span>')
      <span class="subst">#{name}</span>.prototype.constructor.apply(_this, arguments);

    return _this;
  }
  """</span>
  )();</pre></div></div>
            
        </li>
        
        
        <li id="section-279">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-279">&#182;</a>
              </div>
              <p>Default the constructor to call its base</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> args.base? <span class="keyword">and</span> ((<span class="keyword">not</span> args.constructor?) <span class="keyword">or</span> (<span class="keyword">not</span> args.hasOwnProperty(<span class="string">'constructor'</span>)))
    args.<span class="function"><span class="title">constructor</span></span> = -&gt;
      Out.base?.constructor.apply @, arguments</pre></div></div>
            
        </li>
        
        
        <li id="section-280">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-280">&#182;</a>
              </div>
              <p>Inherit if necessary</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> args.base?
    _inherit Out, args.base</pre></div></div>
            
        </li>
        
        
        <li id="section-281">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-281">&#182;</a>
              </div>
              <p>Add the constructor as a method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  oj.addMethod Out::, <span class="string">'constructor'</span>, args.constructor</pre></div></div>
            
        </li>
        
        
        <li id="section-282">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-282">&#182;</a>
              </div>
              <p>Mark new type and its instances with a non-enumerable type and isOJ properties</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  typeProps =
    type: {value:Out, writable:<span class="literal">false</span>, enumerable:<span class="literal">false</span>}
    typeName: {value:name, writable:<span class="literal">false</span>, enumerable:<span class="literal">false</span>}
    isOJ: {value:<span class="literal">true</span>, writable:<span class="literal">false</span>, enumerable:<span class="literal">false</span>}
  oj.addProperties Out, typeProps
  oj.addProperties Out::, typeProps</pre></div></div>
            
        </li>
        
        
        <li id="section-283">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-283">&#182;</a>
              </div>
              <p>Add properties helper to instance</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  propKeys = (_keys args.properties).sort()
  <span class="keyword">if</span> Out::properties?
    propKeys = _uniqueSortedUnion Out::properties, propKeys
  properties = value:propKeys, writable:<span class="literal">false</span>, enumerable:<span class="literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-284">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-284">&#182;</a>
              </div>
              <p>propKeys.has = _reduce propKeys, ((o,item) -&gt; o[item.key] = true; o), {}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  oj.addProperty Out::, <span class="string">'properties'</span>, properties</pre></div></div>
            
        </li>
        
        
        <li id="section-285">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-285">&#182;</a>
              </div>
              <p>Add methods helper to instance</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  methodKeys = (_keys args.methods).sort()
  <span class="keyword">if</span> Out::methods?
    methodKeys = _uniqueSortedUnion Out::methods, methodKeys
  methods = value:methodKeys, writable:<span class="literal">false</span>, enumerable:<span class="literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-286">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-286">&#182;</a>
              </div>
              <p>methodKeys.has = _reduce methodKeys, ((o,item) -&gt; o[item.key] = true; o), {}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  oj.addProperty Out::, <span class="string">'methods'</span>, methods</pre></div></div>
            
        </li>
        
        
        <li id="section-287">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-287">&#182;</a>
              </div>
              <p>Add methods to the type</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _extend args.methods,</pre></div></div>
            
        </li>
        
        
        <li id="section-288">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-288">&#182;</a>
              </div>
              <p>get: Get all properties, or get a single property</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    get: (k) -&gt;
      <span class="keyword">if</span> oj.isString k
        <span class="keyword">if</span> <span class="property">@has</span> k
          <span class="keyword">return</span> @[k]
        <span class="keyword">else</span>
          <span class="keyword">return</span> <span class="literal">undefined</span>
      <span class="keyword">else</span>
        out = {}
        <span class="keyword">for</span> p <span class="keyword">in</span> <span class="property">@properties</span>
          out[p] = @[p]
        out</pre></div></div>
            
        </li>
        
        
        <li id="section-289">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-289">&#182;</a>
              </div>
              <p>set: Set all properties on the object at once</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    set: (k,v) -&gt;
      obj = k</pre></div></div>
            
        </li>
        
        
        <li id="section-290">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-290">&#182;</a>
              </div>
              <p>Optionally take key, value instead of object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> <span class="keyword">not</span> oj.isObject k
        obj = {}
        obj[k] = v;</pre></div></div>
            
        </li>
        
        
        <li id="section-291">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-291">&#182;</a>
              </div>
              <p>Set all keys that are valid properties</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">for</span> key,value <span class="keyword">of</span> obj
        <span class="keyword">if</span> <span class="property">@has</span> key
          @[key] = value
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-292">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-292">&#182;</a>
              </div>
              <p>has: Determine if property exists
TODO: Make this O(1)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    has: (k) -&gt;
      _some <span class="property">@properties</span>, (v) -&gt; v == k</pre></div></div>
            
        </li>
        
        
        <li id="section-293">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-293">&#182;</a>
              </div>
              <p>can: Determine if method exists
TODO: Make this O(1)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    can: (k) -&gt;
      _some <span class="property">@methods</span>, (v) -&gt; v == k</pre></div></div>
            
        </li>
        
        
        <li id="section-294">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-294">&#182;</a>
              </div>
              <p>toJSON: Use properties to generate json</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toJSON: -&gt;
      json = {}
      <span class="keyword">for</span> prop <span class="keyword">in</span> <span class="property">@properties</span>
        json[prop] = @[prop]
      json</pre></div></div>
            
        </li>
        
        
        <li id="section-295">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-295">&#182;</a>
              </div>
              <p>Add methods</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  oj.addMethods Out::, args.methods</pre></div></div>
            
        </li>
        
        
        <li id="section-296">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-296">&#182;</a>
              </div>
              <p>Add the properties</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  oj.addProperties Out::, args.properties

  Out</pre></div></div>
            
        </li>
        
        
        <li id="section-297">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-297">&#182;</a>
              </div>
              <p>unionArguments:
Take arguments and tranform them into options and args.
options is a union of all items in <code>arguments</code> that are objects
args is a concat of all arguments that aren&#39;t objects in the same order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">unionArguments</span></span> = (argList) -&gt;
  options = {}
  args = []
  <span class="keyword">for</span> v <span class="keyword">in</span> argList
    <span class="keyword">if</span> oj.isObject v
      options = _extend options, v
    <span class="keyword">else</span>
      args.push v
  options: options, args: args</pre></div></div>
            
        </li>
        
        
        <li id="section-298">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-298">&#182;</a>
              </div>
              <h2>oj.enum</h2>

            </div>
            
        </li>
        
        
        <li id="section-299">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-299">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">enum</span></span> = (name, args) -&gt;
  <span class="keyword">throw</span> <span class="string">'NYI'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-300">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-300">&#182;</a>
              </div>
              <h2>oj.View</h2>

            </div>
            
        </li>
        
        
        <li id="section-301">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-301">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>oj.View = oj.createType <span class="string">'View'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-302">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-302">&#182;</a>
              </div>
              <p>Views are special objects map properties together. This is a union of arguments
With the remaining arguments becoming a list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor: (options = {}) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-303">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-303">&#182;</a>
              </div>
              <p>console.log &quot;View.constructor: &quot;, JSON.stringify arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"oj.<span class="subst">#{@typeName}</span>: constructor failed to set this.el"</span>) <span class="keyword">unless</span> oj.isDOM <span class="property">@el</span></pre></div></div>
            
        </li>
        
        
        <li id="section-304">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-304">&#182;</a>
              </div>
              <p>Set instance on @el</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _setInstanceOnElement <span class="property">@el</span>, @</pre></div></div>
            
        </li>
        
        
        <li id="section-305">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-305">&#182;</a>
              </div>
              <p>Emit as a tag if new wasn&#39;t called</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@emit</span>() <span class="keyword">if</span> @.__autonew__</pre></div></div>
            
        </li>
        
        
        <li id="section-306">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-306">&#182;</a>
              </div>
              <p>Generate id if missing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    options.id ?= oj.id()</pre></div></div>
            
        </li>
        
        
        <li id="section-307">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-307">&#182;</a>
              </div>
              <p>Add class oj-typeName</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@$el</span>.addClass <span class="string">"oj-<span class="subst">#{@typeName}</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-308">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-308">&#182;</a>
              </div>
              <p>Views automatically set all options to their properties
arguments directly to properties</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@set</span> options</pre></div></div>
            
        </li>
        
        
        <li id="section-309">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-309">&#182;</a>
              </div>
              <p>Remove options that were set</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    options = _omit options, <span class="property">@properties</span>...</pre></div></div>
            
        </li>
        
        
        <li id="section-310">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-310">&#182;</a>
              </div>
              <p>Views pass through remaining options to be attributes on the root element
This can include jquery events and interpreted arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@addAttributes</span> options</pre></div></div>
            
        </li>
        
        
        <li id="section-311">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-311">&#182;</a>
              </div>
              <p>Record if view is fully constructed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@_isConstructed</span> = <span class="literal">true</span>

  properties:</pre></div></div>
            
        </li>
        
        
        <li id="section-312">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-312">&#182;</a>
              </div>
              <p>The element backing the View</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    el:
      get: -&gt; <span class="property">@_el</span>
      set: (v) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-313">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-313">&#182;</a>
              </div>
              <p>Set the element directly if this is a dom element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> oj.isDOMElement v
          <span class="property">@_el</span> = v</pre></div></div>
            
        </li>
        
        
        <li id="section-314">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-314">&#182;</a>
              </div>
              <p>Clear cache of $el</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="property">@_$el</span> = <span class="literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-315">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-315">&#182;</a>
              </div>
              <p>Generate the element from ojml</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">else</span>
          {dom:<span class="property">@_el</span>} = oj.compile css:<span class="number">0</span>, cssMap:<span class="number">0</span>, dom:<span class="number">1</span>, html:<span class="number">0</span>, v
        <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-316">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-316">&#182;</a>
              </div>
              <p>Get and cache jquery-enabled element (readonly)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $el: get: -&gt; <span class="property">@_$el</span> ? (<span class="property">@_$el</span> = $ <span class="property">@el</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-317">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-317">&#182;</a>
              </div>
              <p>Get and set id attribute of view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    id:
      get: -&gt; <span class="property">@$el</span>.attr <span class="string">'id'</span>
      set: (v) -&gt; <span class="property">@$el</span>.attr <span class="string">'id'</span>, v</pre></div></div>
            
        </li>
        
        
        <li id="section-318">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-318">&#182;</a>
              </div>
              <h1>Get and set class attribute of view</h1>
<p>class:
  get: -&gt; @$el.attr &#39;class&#39;
  set: (v) -&gt;</p>
<pre><code># Join arrays with spaces
if oj.isArray v
  v = v.join &#39; &#39;
@$el.attr &#39;class&#39;, v
return</code></pre>
<h1>Alias for class</h1>
<p>c:
  get: -&gt; @class
  set: (v) -&gt; @class = v; return</p>
<p>Get all currently set attributes (readonly)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    attributes: get: -&gt;
      out = {}
      $.each <span class="property">@el</span>.attributes, (index, attr) -&gt; out[ attr.name ] = attr.value;
      out</pre></div></div>
            
        </li>
        
        
        <li id="section-319">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-319">&#182;</a>
              </div>
              <p>Get all currently set themes (readwrite)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    themes: get: -&gt;
      out = {}
      $.each <span class="property">@el</span>.attributes, (index, attr) -&gt; out[ attr.name ] = attr.value;
      out</pre></div></div>
            
        </li>
        
        
        <li id="section-320">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-320">&#182;</a>
              </div>
              <p>Determine if this view has been fully constructed (readonly)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    isConstructed: get: -&gt; <span class="property">@_isConstructed</span> ? <span class="literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-321">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-321">&#182;</a>
              </div>
              <p>Determine if this view has been fully inserted (readonly)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    isInserted:
      get: -&gt; <span class="property">@_isInserted</span> ? <span class="literal">false</span>

  methods:</pre></div></div>
            
        </li>
        
        
        <li id="section-322">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-322">&#182;</a>
              </div>
              <p>Mirror backbone view&#39;s find by selector</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $: -&gt; <span class="property">@$el</span>.find arguments...</pre></div></div>
            
        </li>
        
        
        <li id="section-323">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-323">&#182;</a>
              </div>
              <p>Add a single attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    addAttribute: (name,value) -&gt;
      attr = {}
      attr[name] = value
      <span class="property">@addAttributes</span> attr
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-324">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-324">&#182;</a>
              </div>
              <p>Add attributes and apply the oj magic with jquery binding</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    addAttributes: (attributes) -&gt;
      attr = _clone attributes

      events = _attributesProcessedForOJ attr</pre></div></div>
            
        </li>
        
        
        <li id="section-325">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-325">&#182;</a>
              </div>
              <p>Add attributes as object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> oj.isObject attr
        <span class="keyword">for</span> k,v <span class="keyword">of</span> attr
          <span class="keyword">if</span> k == <span class="string">'class'</span>
            <span class="property">@addClass</span> v</pre></div></div>
            
        </li>
        
        
        <li id="section-326">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-326">&#182;</a>
              </div>
              <p>Boolean attributes have no value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">else</span> <span class="keyword">if</span> v == <span class="literal">true</span>
            att = document.createAttribute k
            <span class="property">@el</span>.setAttributeNode att</pre></div></div>
            
        </li>
        
        
        <li id="section-327">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-327">&#182;</a>
              </div>
              <p>Otherwise add it normally</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">else</span>
            <span class="property">@$el</span>.attr k, v</pre></div></div>
            
        </li>
        
        
        <li id="section-328">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-328">&#182;</a>
              </div>
              <p>Bind events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> events?
        _attributesBindEventsToDOM events, <span class="property">@el</span>
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-329">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-329">&#182;</a>
              </div>
              <p>Remove a single attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    removeAttribute: (name) -&gt;
      <span class="property">@$el</span>.removeAttr name
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-330">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-330">&#182;</a>
              </div>
              <p>Remove multiple attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    removeAttributes: (list) -&gt;
      <span class="keyword">for</span> k <span class="keyword">in</span> list
        <span class="property">@removeAttribute</span> k
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-331">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-331">&#182;</a>
              </div>
              <p>Add a single class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    addClass: (name) -&gt;
      <span class="property">@$el</span>.addClass name
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-332">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-332">&#182;</a>
              </div>
              <p>Remove a single class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    removeClass: (name) -&gt;
      <span class="property">@$el</span>.removeClass name
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-333">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-333">&#182;</a>
              </div>
              <p>Add a single theme</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    addTheme: (name) -&gt;
      <span class="property">@addClass</span> <span class="string">"theme-<span class="subst">#{name}</span>"</span>
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-334">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-334">&#182;</a>
              </div>
              <p>Remove a single theme</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    removeTheme: (name) -&gt;
      <span class="property">@removeClass</span> <span class="string">"theme-<span class="subst">#{name}</span>"</span>
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-335">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-335">&#182;</a>
              </div>
              <p>Clear all themes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    clearThemes: (name) -&gt;
      <span class="property">@$el</span>.removeClass <span class="string">"theme-<span class="subst">#{name}</span>"</span>
      classes = <span class="property">@$el</span>.attr(<span class="string">'class'</span>).split(<span class="string">' '</span>)
      _each classes, (v) -&gt;
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-336">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-336">&#182;</a>
              </div>
              <p>emit: Emit instance as a tag function would do</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    emit: -&gt; oj._argsAppend @; <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-337">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-337">&#182;</a>
              </div>
              <p>Convert View to html</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toHTML: (options) -&gt;
      <span class="property">@el</span>.outerHTML + (<span class="keyword">if</span> options?.minify <span class="keyword">then</span> <span class="string">''</span> <span class="keyword">else</span> <span class="string">'\n'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-338">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-338">&#182;</a>
              </div>
              <p>Convert View to dom (for compiling)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toDOM: -&gt; <span class="property">@el</span></pre></div></div>
            
        </li>
        
        
        <li id="section-339">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-339">&#182;</a>
              </div>
              <p>Convert</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toCSS: (options) -&gt; _cssFromPluginObject (_flattenCSSMap <span class="property">@cssMap</span>), _extend({}, minify:options.minify, tags:<span class="number">0</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-340">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-340">&#182;</a>
              </div>
              <p>Convert</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toCSSMap: -&gt; <span class="property">@type</span>.cssMap</pre></div></div>
            
        </li>
        
        
        <li id="section-341">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-341">&#182;</a>
              </div>
              <p>Convert View to string (for debugging)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toString: -&gt; <span class="property">@toHTML</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-342">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-342">&#182;</a>
              </div>
              <h1>Detach element from dom</h1>
<p>detach: -&gt; throw &#39;detach nyi&#39;</p>
<h1>The implementation is to set el manipulate it, and remember how to set it back</h1>
<h1>Attach element to dom where it use to be</h1>
<p>attach: -&gt; throw &#39;attach nyi&#39;</p>
<h1>The implementation is to unset el from detach</h1>
<p>inserted is called the instance is inserted in the dom (override)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    inserted: -&gt;
      <span class="property">@_isInserted</span> = <span class="literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-343">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-343">&#182;</a>
              </div>
              <p>  oj.View.css: set view&#39;s css with css object mapping, or raw css string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.View.<span class="function"><span class="title">css</span></span> = (css) -&gt;
  <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"oj.<span class="subst">#{@typeName}</span>.css: object or string expected for first argument"</span>) <span class="keyword">unless</span> oj.isString(css) <span class="keyword">or</span> oj.isObject(css)
  <span class="keyword">if</span> oj.isString css
    <span class="property">@cssMap</span>[<span class="string">"oj-<span class="subst">#{@typeName}</span>"</span>] ?= <span class="string">""</span>
    <span class="property">@cssMap</span>[<span class="string">"oj-<span class="subst">#{@typeName}</span>"</span>] += css
  <span class="keyword">else</span>
    <span class="property">@cssMap</span>[<span class="string">"oj-<span class="subst">#{@typeName}</span>"</span>] ?= {}
    cssMap = _setObject {}, <span class="string">".oj-<span class="subst">#{@typeName}</span>"</span>, css
    _extend <span class="property">@cssMap</span>[<span class="string">"oj-<span class="subst">#{@typeName}</span>"</span>], cssMap
  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-344">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-344">&#182;</a>
              </div>
              <p>  oj.View.theme: create a View specific theme with css object mapping</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.View.<span class="function"><span class="title">theme</span></span> = (name, css) -&gt;
  <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"oj.<span class="subst">#{@typeName}</span>.theme: string expected for first argument (theme name)"</span>) <span class="keyword">unless</span> oj.isString name
  <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"oj.<span class="subst">#{@typeName}</span>.css: object expected for second argument"</span>) <span class="keyword">unless</span> oj.isObject(css)

  <span class="property">@cssMap</span>[<span class="string">"oj-<span class="subst">#{@typeName}</span>"</span>] ?= {}
  dashName = _dasherize name
  cssMap = _setObject {}, <span class="string">".oj-<span class="subst">#{@typeName}</span>.theme-<span class="subst">#{dashName}</span>"</span>, css
  _extend <span class="property">@cssMap</span>[<span class="string">"oj-<span class="subst">#{@typeName}</span>"</span>], cssMap
  <span class="property">@themes</span>.push dashName
  <span class="keyword">return</span>

oj.View.cssMap = {}
oj.View.themes = []</pre></div></div>
            
        </li>
        
        
        <li id="section-345">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-345">&#182;</a>
              </div>
              <h2>oj.CollectionView</h2>

            </div>
            
        </li>
        
        
        <li id="section-346">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-346">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>oj.CollectionView = oj.createType <span class="string">'CollectionView'</span>,
  base: oj.View

  constructor: (options) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-347">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-347">&#182;</a>
              </div>
              <p>console.log &quot;CollectionView constructor: &quot;, arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@each</span> = oj.argumentShift options, <span class="string">'each'</span> <span class="keyword">if</span> options?.each?
    <span class="property">@models</span> = oj.argumentShift options, <span class="string">'models'</span> <span class="keyword">if</span> options?.models?

    oj.CollectionView.base.constructor.apply @, arguments</pre></div></div>
            
        </li>
        
        
        <li id="section-348">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-348">&#182;</a>
              </div>
              <p>Once everything is constructed call make precisely once.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@make</span>()

  properties:

    each:
      get: -&gt; <span class="property">@_each</span>
      set: (v) -&gt;
        <span class="property">@_each</span> = v;
        <span class="property">@make</span>() <span class="keyword">if</span> <span class="property">@isConstructed</span>
        <span class="keyword">return</span>

    collection:
      get: -&gt; <span class="property">@models</span>
      set: (v) -&gt; <span class="property">@models</span> = v

    models:
      get: -&gt; <span class="property">@_models</span>
      set: (v) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-349">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-349">&#182;</a>
              </div>
              <p>Unbind events if collection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> oj.isFunction <span class="property">@_models</span>?.<span class="literal">off</span>
          <span class="property">@_models</span>.<span class="literal">off</span> <span class="string">'add remove change reset destroy'</span>, <span class="literal">null</span>, @

        <span class="property">@_models</span> = v</pre></div></div>
            
        </li>
        
        
        <li id="section-350">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-350">&#182;</a>
              </div>
              <p>Bind events if collection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> oj.isFunction <span class="property">@_models</span>?.<span class="literal">on</span>
          <span class="property">@_models</span>.<span class="literal">on</span> <span class="string">'add'</span>, <span class="property">@collectionModelAdded</span>, @
          <span class="property">@_models</span>.<span class="literal">on</span> <span class="string">'remove'</span>, <span class="property">@collectionModelRemoved</span>, @
          <span class="property">@_models</span>.<span class="literal">on</span> <span class="string">'change'</span>, <span class="property">@collectionModelChanged</span>, @
          <span class="property">@_models</span>.<span class="literal">on</span> <span class="string">'destroy'</span>, <span class="property">@collectionModelDestroyed</span>, @
          <span class="property">@_models</span>.<span class="literal">on</span> <span class="string">'reset'</span>, <span class="property">@collectionReset</span>, @

        <span class="property">@make</span>() <span class="keyword">if</span> <span class="property">@isConstructed</span>

        <span class="keyword">return</span>

  methods:</pre></div></div>
            
        </li>
        
        
        <li id="section-351">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-351">&#182;</a>
              </div>
              <p>Override make to create your view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    make: -&gt; <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"oj.<span class="subst">#{@typeName}</span>: `make` method not implemented by custom view"</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-352">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-352">&#182;</a>
              </div>
              <p>Override these events to minimally update on change</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    collectionModelAdded: (model, collection) -&gt; <span class="property">@make</span>()
    collectionModelRemoved: (model, collection, options) -&gt; <span class="property">@make</span>()
    collectionModelChanged: (model, collection, options) -&gt; <span class="comment"># Do nothing</span>
    collectionModelDestroyed: (collection, options) -&gt; <span class="property">@make</span>()
    collectionReset: (collection, options) -&gt; <span class="property">@make</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-353">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-353">&#182;</a>
              </div>
              <h2>oj.ModelView</h2>

            </div>
            
        </li>
        
        
        <li id="section-354">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-354">&#182;</a>
              </div>
              <p>Model view base class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.ModelView = oj.createType <span class="string">'ModelView'</span>,
  base: oj.View

  constructor: (options) -&gt;

    <span class="property">@value</span> = oj.argumentShift options, <span class="string">'value'</span> <span class="keyword">if</span> options?.value?
    <span class="property">@model</span> = oj.argumentShift options, <span class="string">'model'</span> <span class="keyword">if</span> options?.model?

    oj.ModelView.base.constructor.apply @, arguments

  properties:

    model:
      get: -&gt; <span class="property">@_model</span>
      set: (v) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-355">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-355">&#182;</a>
              </div>
              <p>Unbind events on the old model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> oj.isEvent <span class="property">@_model</span>
          <span class="property">@_model</span>.<span class="literal">off</span> <span class="string">'change'</span>, <span class="literal">null</span>, @

        <span class="property">@_model</span> = v;</pre></div></div>
            
        </li>
        
        
        <li id="section-356">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-356">&#182;</a>
              </div>
              <p>Bind events on the new model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> oj.isEvent <span class="property">@_model</span>
          <span class="property">@_model</span>.<span class="literal">on</span> <span class="string">'change'</span>, <span class="property">@modelChanged</span>, @</pre></div></div>
            
        </li>
        
        
        <li id="section-357">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-357">&#182;</a>
              </div>
              <p>Trigger change manually when settings new model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="property">@modelChanged</span>()
        <span class="keyword">return</span>

  methods:</pre></div></div>
            
        </li>
        
        
        <li id="section-358">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-358">&#182;</a>
              </div>
              <p>Override modelChanged if you don&#39;t want a full remake</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    modelChanged: -&gt;
      <span class="property">@$el</span>.oj =&gt;
        <span class="property">@make</span> <span class="property">@mode</span>

    make: (model) -&gt; <span class="keyword">throw</span> <span class="string">"oj.<span class="subst">#{@typeName}</span>: `make` method not implemented on custom view"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-359">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-359">&#182;</a>
              </div>
              <h2>oj.ModelKeyView</h2>

            </div>
            
        </li>
        
        
        <li id="section-360">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-360">&#182;</a>
              </div>
              <p>Model key view base class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.ModelKeyView = oj.createType <span class="string">'ModelKeyView'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-361">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-361">&#182;</a>
              </div>
              <p>Inherit ModelView to handle model and bindings</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  base: oj.ModelView

  constructor: (options) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-362">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-362">&#182;</a>
              </div>
              <p>console.log &quot;ModelKeyView.constructor: &quot;, JSON.stringify arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@key</span> = oj.argumentShift options, <span class="string">'key'</span> <span class="keyword">if</span> options?.key?</pre></div></div>
            
        </li>
        
        
        <li id="section-363">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-363">&#182;</a>
              </div>
              <p>Call super to bind model and value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    oj.ModelKeyView.base.constructor.apply @, arguments

  properties:</pre></div></div>
            
        </li>
        
        
        <li id="section-364">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-364">&#182;</a>
              </div>
              <p>Key used to access model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    key: <span class="literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-365">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-365">&#182;</a>
              </div>
              <p>Value directly gets and sets to the dom
when it changes it must trigger viewChanged</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    value:
      get: -&gt; <span class="keyword">throw</span> <span class="string">"<span class="subst">#{@typeName}</span> value getter not implemented"</span>
      set: (v) -&gt; <span class="keyword">throw</span> <span class="string">"<span class="subst">#{@typeName}</span> value setter not implemented"</span>

  methods:</pre></div></div>
            
        </li>
        
        
        <li id="section-366">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-366">&#182;</a>
              </div>
              <p>When the model changes update the value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    modelChanged: -&gt;
      <span class="keyword">if</span> <span class="property">@model</span>? <span class="keyword">and</span> <span class="property">@key</span>?</pre></div></div>
            
        </li>
        
        
        <li id="section-367">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-367">&#182;</a>
              </div>
              <p>Update the view if necessary</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> <span class="keyword">not</span> <span class="property">@_viewUpdatedModel</span>
          <span class="property">@value</span> = <span class="property">@model</span>.get <span class="property">@key</span>
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-368">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-368">&#182;</a>
              </div>
              <p>When the view changes update the model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    viewChanged: -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-369">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-369">&#182;</a>
              </div>
              <p>Delay view changes because many of them hook before controls update</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      setTimeout (=&gt;
        <span class="keyword">if</span> <span class="property">@model</span>? <span class="keyword">and</span> <span class="property">@key</span>?</pre></div></div>
            
        </li>
        
        
        <li id="section-370">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-370">&#182;</a>
              </div>
              <p>Ensure view changes aren&#39;t triggered twice</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="property">@_viewUpdatedModel</span> = <span class="literal">true</span>
          <span class="property">@model</span>.set <span class="property">@key</span>, <span class="property">@value</span>
          <span class="property">@_viewUpdatedModel</span> = <span class="literal">false</span>
        <span class="keyword">return</span>
        ), <span class="number">10</span>
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-371">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-371">&#182;</a>
              </div>
              <h2>oj.TextBox</h2>

            </div>
            
        </li>
        
        
        <li id="section-372">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-372">&#182;</a>
              </div>
              <p>TextBox control</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.TextBox = oj.createType <span class="string">'TextBox'</span>,

  base: oj.ModelKeyView

  constructor: -&gt;
    {options, args} = oj.unionArguments arguments

    <span class="property">@el</span> = oj =&gt;
      oj.input type:<span class="string">'text'</span>,
        keydown: =&gt; <span class="keyword">if</span> <span class="property">@live</span> <span class="keyword">then</span> <span class="property">@viewChanged</span>(); <span class="keyword">return</span>
        keyup: =&gt; <span class="keyword">if</span> <span class="property">@live</span> <span class="keyword">then</span> <span class="property">@viewChanged</span>(); <span class="keyword">return</span>
        change: =&gt; <span class="property">@viewChanged</span>(); <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-373">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-373">&#182;</a>
              </div>
              <p>Value can be set by argument</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@value</span> = args[<span class="number">0</span>] <span class="keyword">if</span> args.length &gt; <span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-374">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-374">&#182;</a>
              </div>
              <p>Set live if it exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@live</span> = oj.argumentShift options, <span class="string">'live'</span> <span class="keyword">if</span> options?.live?

    oj.TextBox.base.constructor.apply @, [options]

  properties:
    value:
      get: -&gt;
        v = <span class="property">@el</span>.value
        v = <span class="string">''</span> <span class="keyword">if</span> <span class="keyword">not</span> v? <span class="keyword">or</span> v == <span class="string">'undefined'</span>
        v
      set: (v) -&gt;
        <span class="property">@el</span>.value = v; <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-375">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-375">&#182;</a>
              </div>
              <p>Live update model as text changes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    live: <span class="literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-376">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-376">&#182;</a>
              </div>
              <h2>oj.CheckBox</h2>

            </div>
            
        </li>
        
        
        <li id="section-377">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-377">&#182;</a>
              </div>
              <p>CheckBox control</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.CheckBox = oj.createType <span class="string">'CheckBox'</span>,
  base: oj.ModelKeyView

  constructor: -&gt;
    {options, args} = oj.unionArguments arguments

    <span class="property">@el</span> = oj =&gt;
      oj.input type:<span class="string">'checkbox'</span>,
        change: =&gt; <span class="property">@viewChanged</span>(); <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-378">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-378">&#182;</a>
              </div>
              <p>Value can be set by argument</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@value</span> = args[<span class="number">0</span>] <span class="keyword">if</span> args.length &gt; <span class="number">0</span>

    oj.CheckBox.base.constructor.call @, options

  properties:
    value:
      get: -&gt; <span class="property">@el</span>.checked
      set: (v) -&gt;
        v = !!v
        <span class="property">@el</span>.checked = v
        <span class="keyword">if</span> v
          <span class="property">@$el</span>.attr <span class="string">'checked'</span>, <span class="string">'checked'</span>
        <span class="keyword">else</span>
          <span class="property">@$el</span>.removeAttr <span class="string">'checked'</span>
        <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-379">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-379">&#182;</a>
              </div>
              <h2>oj.Text</h2>

            </div>
            
        </li>
        
        
        <li id="section-380">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-380">&#182;</a>
              </div>
              <p>Text control</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.Text = oj.createType <span class="string">'Text'</span>,
  base: oj.ModelKeyView

  constructor: -&gt;
    {options, args} = oj.unionArguments arguments</pre></div></div>
            
        </li>
        
        
        <li id="section-381">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-381">&#182;</a>
              </div>
              <p>Get tag name if provided</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@_tagName</span> = oj.argumentShift options, <span class="string">'tagName'</span>

    <span class="property">@el</span> = oj =&gt;
      oj[<span class="property">@tagName</span>]()</pre></div></div>
            
        </li>
        
        
        <li id="section-382">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-382">&#182;</a>
              </div>
              <p>Value can be set by argument</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@value</span> = args[<span class="number">0</span>] <span class="keyword">if</span> args.length &gt; <span class="number">0</span>

    oj.Text.base.constructor.call @, options

  properties:</pre></div></div>
            
        </li>
        
        
        <li id="section-383">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-383">&#182;</a>
              </div>
              <p>value: text value of this object (readwrite)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    value:
      get: -&gt; <span class="property">@$el</span>.ojValue()
      set: (v) -&gt; <span class="property">@$el</span>.oj(v); <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-384">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-384">&#182;</a>
              </div>
              <p>tagName: name of root tag (writeonce)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    tagName: get: -&gt; <span class="property">@_tagName</span> ? <span class="string">'div'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-385">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-385">&#182;</a>
              </div>
              <h2>oj.TextArea</h2>

            </div>
            
        </li>
        
        
        <li id="section-386">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-386">&#182;</a>
              </div>
              <p>TextArea control</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.TextArea = oj.createType <span class="string">'TextArea'</span>,
  base: oj.ModelKeyView

  constructor: -&gt;
    {options, args} = oj.unionArguments arguments

    <span class="property">@el</span> = oj =&gt;
      oj.textarea
        keydown: =&gt; <span class="keyword">if</span> <span class="property">@live</span> <span class="keyword">then</span> <span class="property">@viewChanged</span>(); <span class="keyword">return</span>
        keyup: =&gt; <span class="keyword">if</span> <span class="property">@live</span> <span class="keyword">then</span> <span class="property">@viewChanged</span>(); <span class="keyword">return</span>
        change: =&gt; <span class="property">@viewChanged</span>(); <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-387">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-387">&#182;</a>
              </div>
              <p>Value can be set by argument</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@value</span> = oj.argumentShift(options, <span class="string">'value'</span>) || args.join(<span class="string">'\n'</span>);

    oj.TextArea.base.constructor.call @, options

  properties:
    value:
      get: -&gt; <span class="property">@el</span>.value
      set: (v) -&gt; <span class="property">@el</span>.value = v; <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-388">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-388">&#182;</a>
              </div>
              <p>Live update model as text changes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    live: <span class="literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-389">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-389">&#182;</a>
              </div>
              <h2>oj.ListBox</h2>

            </div>
            
        </li>
        
        
        <li id="section-390">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-390">&#182;</a>
              </div>
              <p>ListBox control</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.ListBox = oj.createType <span class="string">'ListBox'</span>,
  base: oj.ModelKeyView

  constructor: -&gt;
    {options, args} = oj.unionArguments arguments

    <span class="property">@el</span> = oj =&gt;
      oj.select change: =&gt; <span class="property">@viewChanged</span>(); <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-391">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-391">&#182;</a>
              </div>
              <p>@options is a list of elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@options</span> = oj.argumentShift options, <span class="string">'options'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-392">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-392">&#182;</a>
              </div>
              <p>Value can be set by argument</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@value</span> = args[<span class="number">0</span>] <span class="keyword">if</span> args.length &gt; <span class="number">0</span>

    oj.ListBox.base.constructor.apply @, [options]

  properties:
    value:
      get: -&gt; <span class="property">@$el</span>.val()
      set: (v) -&gt; <span class="property">@$el</span>.val(v); <span class="keyword">return</span>

    options:
      get: -&gt; <span class="property">@_options</span>
      set: (v) -&gt;
        <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"oj.<span class="subst">#{@typeName}</span>.options array is missing"</span>) <span class="keyword">unless</span> oj.isArray v
        <span class="property">@_options</span> = v
        <span class="property">@$el</span>.oj -&gt;
          <span class="keyword">for</span> op <span class="keyword">in</span> v
            oj.option op
          <span class="keyword">return</span>
        <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-393">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-393">&#182;</a>
              </div>
              <h2>oj.Button</h2>

            </div>
            
        </li>
        
        
        <li id="section-394">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-394">&#182;</a>
              </div>
              <p>Button control</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.Button = oj.createType <span class="string">'Button'</span>,
  base: oj.View

  constructor: -&gt;
    {options, args} = oj.unionArguments arguments</pre></div></div>
            
        </li>
        
        
        <li id="section-395">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-395">&#182;</a>
              </div>
              <p>Label is first argument</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    title = <span class="string">''</span>
    <span class="keyword">if</span> args.length &gt; <span class="number">0</span>
      title = args[<span class="number">0</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-396">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-396">&#182;</a>
              </div>
              <p>Label is specified as option</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> options.title?
      title = oj.argumentShift(options, <span class="string">'title'</span>)

    <span class="property">@el</span> = oj =&gt;
      oj.button(title)

    oj.Button.base.constructor.apply @, [options]
    <span class="property">@title</span> = title
  properties:
    title:
      get: -&gt; <span class="property">@_title</span> ? <span class="string">''</span>
      set: (v) -&gt; <span class="property">@$el</span>.oj (<span class="property">@_title</span> = v); <span class="keyword">return</span>

  methods:
    click: -&gt;
      <span class="keyword">if</span> arguments.length &gt; <span class="number">0</span>
        <span class="property">@$el</span>.click(arguments...)
      <span class="keyword">else</span>
        <span class="property">@$el</span>.click()</pre></div></div>
            
        </li>
        
        
        <li id="section-397">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-397">&#182;</a>
              </div>
              <h2>oj.Link</h2>

            </div>
            
        </li>
        
        
        <li id="section-398">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-398">&#182;</a>
              </div>
              <p>oj.Link = class Link inherits Control</p>
<h2>oj.List</h2>

            </div>
            
        </li>
        
        
        <li id="section-399">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-399">&#182;</a>
              </div>
              <p>List control with model bindings and live editing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.List = oj.createType <span class="string">'List'</span>,
  base: oj.CollectionView

  constructor: -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-400">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-400">&#182;</a>
              </div>
              <p>console.log &quot;List constructor: &quot;, arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    {options, args} = oj.unionArguments arguments</pre></div></div>
            
        </li>
        
        
        <li id="section-401">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-401">&#182;</a>
              </div>
              <p>tagName is write-once</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@_tagName</span> = oj.argumentShift options, <span class="string">'tagName'</span>

    <span class="property">@itemTagName</span> = oj.argumentShift options, <span class="string">'itemTagName'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-402">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-402">&#182;</a>
              </div>
              <p>Generate el</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@el</span> = oj =&gt;
      oj[<span class="property">@tagName</span>]()</pre></div></div>
            
        </li>
        
        
        <li id="section-403">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-403">&#182;</a>
              </div>
              <p>Use el if it was passed in</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@el</span> = oj.argumentShift(options, <span class="string">'el'</span>) <span class="keyword">if</span> options.el?</pre></div></div>
            
        </li>
        
        
        <li id="section-404">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-404">&#182;</a>
              </div>
              <p>Default @each function to pass through values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    options.each ?= (model) -&gt;
      <span class="keyword">if</span> (oj.isString model) <span class="keyword">or</span> (oj.isNumber model) <span class="keyword">or</span> (oj.isBoolean model)
        model
      <span class="keyword">else</span>
        JSON.stringify model</pre></div></div>
            
        </li>
        
        
        <li id="section-405">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-405">&#182;</a>
              </div>
              <p>Args have been handled so don&#39;t pass them on</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    oj.List.base.constructor.apply @, [options]</pre></div></div>
            
        </li>
        
        
        <li id="section-406">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-406">&#182;</a>
              </div>
              <p>Set @items to options or args if they exist</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    items = <span class="keyword">if</span> args.length &gt; <span class="number">0</span> <span class="keyword">then</span> args <span class="keyword">else</span> <span class="literal">null</span>
    <span class="property">@items</span> = <span class="keyword">if</span> options.items? <span class="keyword">then</span> (oj.argumentShift options, <span class="string">'items'</span>) <span class="keyword">else</span> items</pre></div></div>
            
        </li>
        
        
        <li id="section-407">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-407">&#182;</a>
              </div>
              <h3>Properties</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  properties:</pre></div></div>
            
        </li>
        
        
        <li id="section-408">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-408">&#182;</a>
              </div>
              <p>items: get or set all items at once (readwrite)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    items:
      get: -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-409">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-409">&#182;</a>
              </div>
              <p>  Used cached items or items as interpreted by ojValues jquery plugin</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">return</span> <span class="property">@_items</span> <span class="keyword">if</span> <span class="property">@_items</span>?
        v = <span class="property">@$items</span>.ojValues()

      set: (v) -&gt; <span class="property">@_items</span> = v; <span class="property">@make</span>(); <span class="keyword">return</span>

    count: get: -&gt; <span class="property">@$items</span>.length</pre></div></div>
            
        </li>
        
        
        <li id="section-410">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-410">&#182;</a>
              </div>
              <p>tagName: name of root tag (writeonce)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    tagName: get: -&gt; <span class="property">@_tagName</span> ? <span class="string">'div'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-411">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-411">&#182;</a>
              </div>
              <p>itemTagName: name of item tags (readwrite)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    itemTagName:
      get: -&gt; <span class="property">@_itemTagName</span> ? <span class="string">'div'</span>
      set: (v) -&gt; <span class="property">@_itemTagName</span> = v; <span class="property">@make</span>(); <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-412">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-412">&#182;</a>
              </div>
              <p>$items: list of <code>&lt;li&gt;</code> elements (readonly)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $items: get: -&gt; <span class="property">@_$items</span> ? (<span class="property">@_$items</span> = <span class="property">@$</span>(<span class="string">"&gt; <span class="subst">#{@itemTagName}</span>"</span>))</pre></div></div>
            
        </li>
        
        
        <li id="section-413">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-413">&#182;</a>
              </div>
              <h3>Methods</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  methods:</pre></div></div>
            
        </li>
        
        
        <li id="section-414">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-414">&#182;</a>
              </div>
              <h4>Accessor Methods</h4>
<p>item: get or set item value at item ix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    item: (ix, ojml) -&gt;
      ix = <span class="property">@_bound</span> ix, <span class="property">@count</span>, <span class="string">".item: index"</span>
      <span class="keyword">if</span> ojml?
        <span class="property">@$item</span>(ix).oj ojml
        <span class="keyword">return</span>
      <span class="keyword">else</span>
        <span class="property">@$item</span>(ix).ojValue()</pre></div></div>
            
        </li>
        
        
        <li id="section-415">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-415">&#182;</a>
              </div>
              <p>$item: <code>&lt;li&gt;</code> element for a given item ix. The tag name may change.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $item: (ix) -&gt;
      ix = <span class="property">@_bound</span> ix, <span class="property">@count</span>, <span class="string">".$item: index"</span>
      <span class="property">@$items</span>.eq(ix)</pre></div></div>
            
        </li>
        
        
        <li id="section-416">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-416">&#182;</a>
              </div>
              <h4>CollectionView Methods</h4>
<p>make: Remake view from property data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    make: -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-417">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-417">&#182;</a>
              </div>
              <p>  Some properties call make before construction completes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">return</span> <span class="keyword">unless</span> <span class="property">@isConstructed</span></pre></div></div>
            
        </li>
        
        
        <li id="section-418">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-418">&#182;</a>
              </div>
              <p>  Convert models to views</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      views = []
      <span class="keyword">if</span> <span class="property">@models</span>? <span class="keyword">and</span> <span class="property">@each</span>?
        models = <span class="keyword">if</span> oj.isEvent <span class="property">@models</span> <span class="keyword">then</span> <span class="property">@models</span>.models <span class="keyword">else</span> <span class="property">@models</span>
        <span class="keyword">for</span> model <span class="keyword">in</span> models
          views.push <span class="property">@_itemFromModel</span> model</pre></div></div>
            
        </li>
        
        
        <li id="section-419">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-419">&#182;</a>
              </div>
              <p>  Items are already views</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">else</span> <span class="keyword">if</span> <span class="property">@items</span>?
        views = <span class="property">@items</span></pre></div></div>
            
        </li>
        
        
        <li id="section-420">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-420">&#182;</a>
              </div>
              <p>  Render the views</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="property">@$el</span>.oj =&gt;
        <span class="keyword">for</span> view <span class="keyword">in</span> views
          <span class="property">@_itemElFromItem</span> view

      <span class="property">@itemsChanged</span>()
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-421">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-421">&#182;</a>
              </div>
              <h4>CollectionView Events</h4>
<p>collectionModelAdded: Model add occurred, add the item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    collectionModelAdded: (m, c) -&gt;
      ix = c.indexOf m
      item = <span class="property">@_itemFromModel</span> m
      <span class="property">@add</span> ix, item
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-422">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-422">&#182;</a>
              </div>
              <p>collectionModelRemoved: Model remove occured, delete the item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    collectionModelRemoved: (m, c, o) -&gt;
      <span class="property">@remove</span> o.index
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-423">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-423">&#182;</a>
              </div>
              <p>collectionModelRemoved: On add</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    collectionReset: -&gt;
      <span class="property">@make</span>()
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-424">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-424">&#182;</a>
              </div>
              <h4>Helper Methods</h4>
<p>  _itemFromModel: Helper to map model to item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _itemFromModel: (model) -&gt;
      oj =&gt;
        <span class="property">@each</span> model</pre></div></div>
            
        </li>
        
        
        <li id="section-425">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-425">&#182;</a>
              </div>
              <p>  _itemElFromItem: Helper to create itemTagName wrapped item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _itemElFromItem: (item) -&gt;
      oj[<span class="property">@itemTagName</span>] item</pre></div></div>
            
        </li>
        
        
        <li id="section-426">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-426">&#182;</a>
              </div>
              <p>  _bound: Bound index to allow negatives, throw when out of range</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _bound: (ix, count, message) -&gt;
      _boundOrThrow ix,count,message,<span class="property">@typeName</span></pre></div></div>
            
        </li>
        
        
        <li id="section-427">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-427">&#182;</a>
              </div>
              <h4>Events</h4>
<p>itemsChanged: Model changed occured, clear relevant cached values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    itemsChanged: -&gt; <span class="property">@_items</span> = <span class="literal">null</span>; <span class="property">@_$items</span> = <span class="literal">null</span>; <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-428">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-428">&#182;</a>
              </div>
              <h4>Manipulation Methods</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>    add: (ix, ojml) -&gt;

      ix = <span class="property">@_bound</span> ix, <span class="property">@count</span>+<span class="number">1</span>, <span class="string">".add: index"</span>

      tag = <span class="property">@itemTagName</span></pre></div></div>
            
        </li>
        
        
        <li id="section-429">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-429">&#182;</a>
              </div>
              <p>Empty</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> <span class="property">@count</span> == <span class="number">0</span>
        <span class="property">@$el</span>.oj -&gt; oj[tag] ojml</pre></div></div>
            
        </li>
        
        
        <li id="section-430">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-430">&#182;</a>
              </div>
              <p>Last</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">else</span> <span class="keyword">if</span> ix == <span class="property">@count</span>
        <span class="property">@$item</span>(ix-<span class="number">1</span>).ojAfter -&gt; oj[tag] ojml</pre></div></div>
            
        </li>
        
        
        <li id="section-431">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-431">&#182;</a>
              </div>
              <p>Not last</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">else</span>
        <span class="property">@$item</span>(ix).ojBefore -&gt; oj[tag] ojml

      <span class="property">@itemsChanged</span>()
      <span class="keyword">return</span>

    remove: (ix) -&gt;
      ix = <span class="property">@_bound</span> ix, <span class="property">@count</span>, <span class="string">".remove: index"</span>
      out = <span class="property">@item</span> ix
      <span class="property">@$item</span>(ix).remove()
      <span class="property">@itemsChanged</span>()
      out

    move: (ixFrom, ixTo = -<span class="number">1</span>) -&gt;
      <span class="keyword">return</span> <span class="keyword">if</span> ixFrom == ixTo

      ixFrom = <span class="property">@_bound</span> ixFrom, <span class="property">@count</span>, <span class="string">".move: fromIndex"</span>
      ixTo = <span class="property">@_bound</span> ixTo, <span class="property">@count</span>, <span class="string">".move: toIndex"</span>

      <span class="keyword">if</span> ixTo &gt; ixFrom
        <span class="property">@$item</span>(ixFrom).insertAfter <span class="property">@$item</span>(ixTo)
      <span class="keyword">else</span>
        <span class="property">@$item</span>(ixFrom).insertBefore <span class="property">@$item</span>(ixTo)

      <span class="property">@itemsChanged</span>()
      <span class="keyword">return</span>

    swap: (ix1, ix2) -&gt;
      <span class="keyword">return</span> <span class="keyword">if</span> ix1 == ix2

      ix1 = <span class="property">@_bound</span> ix1, <span class="property">@count</span>, <span class="string">".swap: firstIndex"</span>
      ix2 = <span class="property">@_bound</span> ix2, <span class="property">@count</span>, <span class="string">".swap: secondIndex"</span>

      <span class="keyword">if</span> Math.abs(ix1-ix2) == <span class="number">1</span>
        <span class="property">@move</span> ix1, ix2
      <span class="keyword">else</span>
        ixMin = Math.min ix1, ix2
        ixMax = Math.max ix1, ix2
        <span class="property">@move</span> ixMax, ixMin
        <span class="property">@move</span> ixMin+<span class="number">1</span>, ixMax
      <span class="property">@itemsChanged</span>()
      <span class="keyword">return</span>

    unshift: (v) -&gt; <span class="property">@add</span> <span class="number">0</span>, v; <span class="keyword">return</span>

    shift: -&gt; <span class="property">@remove</span> <span class="number">0</span>

    push: (v) -&gt; <span class="property">@add</span>(<span class="property">@count</span>, v); <span class="keyword">return</span>

    pop: -&gt; <span class="property">@remove</span> -<span class="number">1</span>

    clear: -&gt; <span class="property">@$items</span>.remove(); <span class="property">@itemsChanged</span>(); <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-432">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-432">&#182;</a>
              </div>
              <h2>oj.NumberList</h2>

            </div>
            
        </li>
        
        
        <li id="section-433">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-433">&#182;</a>
              </div>
              <p>NumberList is a <code>List</code> specialized with <code>&lt;ol&gt;</code> and <code>&lt;li&gt;</code> tags</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.NumberList = oj.createType <span class="string">'NumberList'</span>,
  base: oj.List
  constructor: -&gt;
    args = [{tagName:<span class="string">'ol'</span>, itemTagName:<span class="string">'li'</span>}, arguments...]
    oj.NumberList.base.constructor.apply @, args</pre></div></div>
            
        </li>
        
        
        <li id="section-434">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-434">&#182;</a>
              </div>
              <h2>oj.BulletList</h2>

            </div>
            
        </li>
        
        
        <li id="section-435">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-435">&#182;</a>
              </div>
              <p>BulletList is a <code>List</code> specialized with <code>&lt;ul&gt;</code> and <code>&lt;li&gt;</code> tags</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.BulletList = oj.createType <span class="string">'BulletList'</span>,
  base: oj.List
  constructor: -&gt;
    args = [{tagName:<span class="string">'ul'</span>, itemTagName:<span class="string">'li'</span>}, arguments...]
    oj.BulletList.base.constructor.apply @, args</pre></div></div>
            
        </li>
        
        
        <li id="section-436">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-436">&#182;</a>
              </div>
              <h2>oj.Table</h2>

            </div>
            
        </li>
        
        
        <li id="section-437">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-437">&#182;</a>
              </div>
              <p>Table control</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.Table = oj.createType <span class="string">'Table'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-438">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-438">&#182;</a>
              </div>
              <p>Inherit and construct</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  base: oj.CollectionView

  constructor: -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-439">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-439">&#182;</a>
              </div>
              <p>console.log &quot;Table constructor: &quot;, arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    {options, args} = oj.unionArguments arguments</pre></div></div>
            
        </li>
        
        
        <li id="section-440">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-440">&#182;</a>
              </div>
              <p>Generate el</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@el</span> = oj =&gt;
      oj.table()</pre></div></div>
            
        </li>
        
        
        <li id="section-441">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-441">&#182;</a>
              </div>
              <p>Use el if it was passed in</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@el</span> = oj.argumentShift(options, <span class="string">'el'</span>) <span class="keyword">if</span> options.el?</pre></div></div>
            
        </li>
        
        
        <li id="section-442">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-442">&#182;</a>
              </div>
              <p>Default @each function to pass through values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    options.each ?= (model,cell) -&gt;
      values = <span class="keyword">if</span> (oj.isString model) <span class="keyword">or</span> (oj.isNumber model) <span class="keyword">or</span> (oj.isBoolean model)
        [model]
      <span class="keyword">else</span> <span class="keyword">if</span> (oj.isEvent model) <span class="keyword">and</span> <span class="keyword">typeof</span> model.attributes == <span class="string">'object'</span>
        _values model.attributes
      <span class="keyword">else</span>
        _values model
      cell v <span class="keyword">for</span> v <span class="keyword">in</span> values</pre></div></div>
            
        </li>
        
        
        <li id="section-443">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-443">&#182;</a>
              </div>
              <p>Args have been handled so don&#39;t pass them on</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    oj.Table.base.constructor.apply @, [options]</pre></div></div>
            
        </li>
        
        
        <li id="section-444">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-444">&#182;</a>
              </div>
              <p>Validate args as arrays</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">for</span> arg <span class="keyword">in</span> args
      <span class="keyword">unless</span> oj.isArray arg
        <span class="keyword">throw</span> <span class="keyword">new</span> Error <span class="string">'oj.Table: array expected for row arguments'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-445">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-445">&#182;</a>
              </div>
              <p>Set @rows to options or args if they exist</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    rows = (oj.argumentShift options, <span class="string">'rows'</span>) ? args

    <span class="keyword">if</span> rows.length &gt; <span class="number">0</span>
      <span class="property">@rows</span> = rows</pre></div></div>
            
        </li>
        
        
        <li id="section-446">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-446">&#182;</a>
              </div>
              <h3>Properties</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  properties:</pre></div></div>
            
        </li>
        
        
        <li id="section-447">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-447">&#182;</a>
              </div>
              <p>rowCount: The number of rows (readonly)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    rowCount: get: -&gt; <span class="property">@$trs</span>.length</pre></div></div>
            
        </li>
        
        
        <li id="section-448">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-448">&#182;</a>
              </div>
              <p>columnCount: The number of columns (readonly)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    columnCount: get: -&gt;
      <span class="keyword">if</span> (trlen = <span class="property">@$tr</span>(<span class="number">0</span>).find(<span class="string">'&gt; td'</span>).length) &gt; <span class="number">0</span>
        trlen
      <span class="keyword">else</span> <span class="keyword">if</span> (thlen = <span class="property">@$theadTR</span>.find(<span class="string">'&gt; th'</span>).length) &gt; <span class="number">0</span>
        thlen
      <span class="keyword">else</span> <span class="keyword">if</span> (tflen = <span class="property">@$tfootTR</span>.find(<span class="string">'&gt; td'</span>).length) &gt; <span class="number">0</span>
        tflen
      <span class="keyword">else</span>
        <span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-449">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-449">&#182;</a>
              </div>
              <h4>Accessor properties</h4>
<p>rows: Row values as a list of lists as interpreted by ojValue plugin (readwrite)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    rows:
      get: -&gt;
        <span class="keyword">return</span> <span class="property">@_rows</span> <span class="keyword">if</span> <span class="property">@_rows</span>?
        <span class="property">@_rows</span> = []
        <span class="keyword">for</span> rx <span class="keyword">in</span> [<span class="number">0.</span>..<span class="property">@rowCount</span>] <span class="keyword">by</span> <span class="number">1</span>
          r = oj._map (<span class="property">@$tdsRow</span> rx), ($td) -&gt; $td.ojValues()
          <span class="property">@_rows</span>.push r
        <span class="property">@_rows</span>

      set: (list) -&gt;
        <span class="keyword">return</span> <span class="property">@clearBody</span>() <span class="keyword">unless</span> list? <span class="keyword">and</span> list.length &gt; <span class="number">0</span>
        <span class="property">@_rows</span> = list; <span class="property">@make</span>(); <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-450">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-450">&#182;</a>
              </div>
              <p>header: Array of header values as interpreted by ojValue plugin (readwrite)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    header:
      get: -&gt;
        <span class="property">@$theadTR</span>.find(<span class="string">'&gt; th'</span>).ojValues()
      set: (list) -&gt;
        <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'oj.Table.header: array expected for first argument'</span>) <span class="keyword">unless</span> oj.isArray list
        <span class="keyword">return</span> <span class="property">@clearHeader</span>() <span class="keyword">unless</span> list? <span class="keyword">and</span> list.length &gt; <span class="number">0</span>
        <span class="property">@$theadTRMake</span>.oj =&gt;
          <span class="keyword">for</span> ojml <span class="keyword">in</span> list
            oj.th ojml</pre></div></div>
            
        </li>
        
        
        <li id="section-451">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-451">&#182;</a>
              </div>
              <p>footer: Array of footer values as interpreted by ojValue plugin (readwrite)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    footer:
      get: -&gt;
        <span class="property">@$tfootTR</span>.find(<span class="string">'&gt; td'</span>).ojValues()
      set: (list) -&gt;
        <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'oj.Table.footer: array expected for first argument'</span>) <span class="keyword">unless</span> oj.isArray list
        <span class="keyword">return</span> <span class="property">@clearFooter</span>() <span class="keyword">unless</span> list? <span class="keyword">and</span> list.length &gt; <span class="number">0</span>
        <span class="property">@$tfootTRMake</span>.oj =&gt;
          <span class="keyword">for</span> ojml <span class="keyword">in</span> list
            oj.td ojml</pre></div></div>
            
        </li>
        
        
        <li id="section-452">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-452">&#182;</a>
              </div>
              <p>caption: The table caption (readwrite)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    caption:
      get: -&gt; <span class="property">@$caption</span>.ojValue()
      set: (v) -&gt; <span class="property">@$captionMake</span>.oj v; <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-453">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-453">&#182;</a>
              </div>
              <p>Element accessors</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $table: get: -&gt; <span class="property">@$el</span>

    $caption: get: -&gt; <span class="property">@$</span> <span class="string">'&gt; caption'</span>

    $colgroup: get: -&gt; <span class="property">@$</span> <span class="string">'&gt; colgroup'</span>

    $thead: get: -&gt; <span class="property">@$</span> <span class="string">'&gt; thead'</span>

    $tfoot: get: -&gt; <span class="property">@$</span> <span class="string">'&gt; tfoot'</span>

    $tbody: get: -&gt; <span class="property">@$</span> <span class="string">'&gt; tbody'</span>

    $theadTR: get: -&gt; <span class="property">@$thead</span>.find <span class="string">'&gt; tr'</span>

    $tfootTR: get: -&gt; <span class="property">@$tfoot</span>.find <span class="string">'&gt; tr'</span>

    $ths: get: -&gt; <span class="property">@$theadTR</span>.find <span class="string">'&gt; th'</span>

    $trs: get: -&gt; <span class="property">@_$trs</span> ? (<span class="property">@_$trs</span> = <span class="property">@$</span>(<span class="string">"&gt; tbody &gt; tr"</span>))</pre></div></div>
            
        </li>
        
        
        <li id="section-454">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-454">&#182;</a>
              </div>
              <p>Table tags must have an order: <code>&lt;caption&gt;</code> <code>&lt;colgroup&gt;</code> <code>&lt;thead&gt;</code> <code>&lt;tfoot&gt;</code> <code>&lt;tbody&gt;</code>
These accessors create table tags and preserve this order very carefully</p>
<p>$colgroupMake: get or create <code>&lt;colgroup&gt;</code> after <code>&lt;caption&gt;</code> or prepended to <code>&lt;table&gt;</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $colgroupMake: get: -&gt;
      <span class="keyword">return</span> <span class="property">@$colgroup</span> <span class="keyword">if</span> <span class="property">@$colgroup</span>.length &gt; <span class="number">0</span>
      t = <span class="string">'&lt;colgroup&gt;&lt;/colgroup&gt;'</span>
      <span class="keyword">if</span> <span class="property">@$caption</span>.length &gt; <span class="number">0</span>
        <span class="property">@$caption</span>.insertAfter t
      <span class="keyword">else</span>
        <span class="property">@$table</span>.append t
      <span class="property">@$tbody</span></pre></div></div>
            
        </li>
        
        
        <li id="section-455">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-455">&#182;</a>
              </div>
              <p>$captionMake: get or create <code>&lt;caption&gt;</code> prepended to <code>&lt;table&gt;</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $captionMake: get: -&gt;
      <span class="keyword">return</span> <span class="property">@$caption</span> <span class="keyword">if</span> <span class="property">@$caption</span>.length &gt; <span class="number">0</span>
      <span class="property">@$table</span>.prepend <span class="string">'&lt;caption&gt;&lt;/caption&gt;'</span>
      <span class="property">@$caption</span></pre></div></div>
            
        </li>
        
        
        <li id="section-456">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-456">&#182;</a>
              </div>
              <p>$tfootMake: get or create <code>&lt;tfoot&gt;</code> before <code>&lt;tbody&gt;</code> or appended to <code>&lt;table&gt;</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $tfootMake: get: -&gt;
      <span class="keyword">return</span> <span class="property">@$tfoot</span> <span class="keyword">if</span> <span class="property">@$tfoot</span>.length &gt; <span class="number">0</span>
      t = <span class="string">'&lt;tfoot&gt;&lt;/tfoot&gt;'</span>
      <span class="keyword">if</span> <span class="property">@$tfoot</span>.length &gt; <span class="number">0</span>
        <span class="property">@$tfoot</span>.insertBefore t
      <span class="keyword">else</span>
        <span class="property">@$table</span>.append t

      <span class="property">@$tfoot</span></pre></div></div>
            
        </li>
        
        
        <li id="section-457">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-457">&#182;</a>
              </div>
              <p>$theadMake: get or create <code>&lt;thead&gt;</code> after <code>&lt;colgroup&gt;</code> or after <code>&lt;caption&gt;</code>, or prepended to <code>&lt;table&gt;</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $theadMake: get: -&gt;
      <span class="keyword">return</span> <span class="property">@$thead</span> <span class="keyword">if</span> <span class="property">@$thead</span>.length &gt; <span class="number">0</span>
      t = <span class="string">'&lt;thead&gt;&lt;/thead&gt;'</span>
      <span class="keyword">if</span> <span class="property">@$colgroup</span>.length &gt; <span class="number">0</span>
        <span class="property">@$colgroup</span>.insertAfter t
      <span class="keyword">else</span> <span class="keyword">if</span> <span class="property">@$caption</span>.length &gt; <span class="number">0</span>
        <span class="property">@$caption</span>.insertAfter t
      <span class="keyword">else</span>
        <span class="property">@$table</span>.prepend t

      <span class="property">@$thead</span></pre></div></div>
            
        </li>
        
        
        <li id="section-458">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-458">&#182;</a>
              </div>
              <p>$tbodyMake: get or create <code>&lt;tbody&gt;</code> appened to <code>&lt;table&gt;</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $tbodyMake: get: -&gt;
      <span class="keyword">return</span> <span class="property">@$tbody</span> <span class="keyword">if</span> <span class="property">@$tbody</span>.length &gt; <span class="number">0</span>
      <span class="property">@$table</span>.append <span class="string">'&lt;tbody&gt;&lt;/tbody&gt;'</span>
      <span class="property">@$tbody</span></pre></div></div>
            
        </li>
        
        
        <li id="section-459">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-459">&#182;</a>
              </div>
              <p>$theadTRMake: get or create <code>&lt;tr&gt;</code> inside of <code>&lt;thead&gt;</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $theadTRMake: get: -&gt;
      <span class="keyword">return</span> <span class="property">@$theadTR</span> <span class="keyword">if</span> <span class="property">@$theadTR</span>.length &gt; <span class="number">0</span>
      <span class="property">@$theadMake</span>.html <span class="string">'&lt;tr&gt;&lt;/tr&gt;'</span>
      <span class="property">@$theadTR</span></pre></div></div>
            
        </li>
        
        
        <li id="section-460">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-460">&#182;</a>
              </div>
              <p>$tfootTRMake: get or create <code>&lt;tr&gt;</code> inside of <code>&lt;tfoot&gt;</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $tfootTRMake: get: -&gt;
      <span class="keyword">return</span> <span class="property">@$tfootTR</span> <span class="keyword">if</span> <span class="property">@$tfootTR</span>.length &gt; <span class="number">0</span>
      <span class="property">@$tfootMake</span>.html <span class="string">'&lt;tr&gt;&lt;/tr&gt;'</span>
      <span class="property">@$tfootTR</span></pre></div></div>
            
        </li>
        
        
        <li id="section-461">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-461">&#182;</a>
              </div>
              <h3>Methods</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  methods:</pre></div></div>
            
        </li>
        
        
        <li id="section-462">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-462">&#182;</a>
              </div>
              <h4>CollectionView Methods</h4>
<p>make: Remake everything</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    make: -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-463">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-463">&#182;</a>
              </div>
              <p>  Some properties call make before construction completes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">return</span> <span class="keyword">unless</span> <span class="property">@isConstructed</span></pre></div></div>
            
        </li>
        
        
        <li id="section-464">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-464">&#182;</a>
              </div>
              <p>  Convert models to views</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      rowViews = []
      <span class="keyword">if</span> <span class="property">@models</span>? <span class="keyword">and</span> <span class="property">@each</span>?
        models = <span class="keyword">if</span> oj.isEvent <span class="property">@models</span> <span class="keyword">then</span> <span class="property">@models</span>.models <span class="keyword">else</span> <span class="property">@_models</span>
        <span class="keyword">for</span> model <span class="keyword">in</span> models
          rowViews.push <span class="property">@_rowFromModel</span> model</pre></div></div>
            
        </li>
        
        
        <li id="section-465">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-465">&#182;</a>
              </div>
              <p>  Rows need tds to become views</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">else</span> <span class="keyword">if</span> <span class="property">@rows</span>?
        <span class="keyword">for</span> row <span class="keyword">in</span> <span class="property">@rows</span>
          rowViews.push oj -&gt;
            <span class="keyword">for</span> c <span class="keyword">in</span> row
              oj.td c</pre></div></div>
            
        </li>
        
        
        <li id="section-466">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-466">&#182;</a>
              </div>
              <p>  Render rows into tbody</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> rowViews.length &gt; <span class="number">0</span>
        <span class="property">@$tbodyMake</span>.oj =&gt;
          <span class="keyword">for</span> r <span class="keyword">in</span> rowViews
            oj.tr r

      <span class="property">@bodyChanged</span>()
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-467">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-467">&#182;</a>
              </div>
              <h4>CollectionView Events</h4>
<p>On add minimally create the missing model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    collectionModelAdded: (m, c) -&gt;
      rx = c.indexOf m
      row = <span class="property">@_rowFromModel</span> m
      <span class="property">@_addRowTR</span> rx, oj -&gt; oj.tr row
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-468">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-468">&#182;</a>
              </div>
              <p>On add minimally create the missing model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    collectionModelRemoved: (m, c, o) -&gt;
      <span class="property">@removeRow</span> o.index
      <span class="keyword">return</span>

    collectionReset: -&gt;
      <span class="property">@make</span>()
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-469">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-469">&#182;</a>
              </div>
              <h4>Accessor Methods</h4>
<p>table.header(r,ojml)    // value for header
table.cell(r,c,ojml)    // get/set value for cell</p>
<p>$tr: Get <code>&lt;tr&gt;</code> jquery element at row rx</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $tr: (rx) -&gt;
      rx = <span class="keyword">if</span> rx &lt; <span class="number">0</span> <span class="keyword">then</span> rx + count <span class="keyword">else</span> rx
      <span class="property">@$trs</span>.eq(rx)</pre></div></div>
            
        </li>
        
        
        <li id="section-470">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-470">&#182;</a>
              </div>
              <p>$tdsRow: Get list of <code>&lt;td&gt;</code>s in row rx</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $tdsRow: (rx) -&gt;
      rx = <span class="keyword">if</span> rx &lt; <span class="number">0</span> <span class="keyword">then</span> rx + count <span class="keyword">else</span> rx
      <span class="property">@$tr</span>(rx).find <span class="string">'&gt; td'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-471">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-471">&#182;</a>
              </div>
              <p>$td: Get <code>&lt;td&gt;</code> row rx, column cx</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $td: (rx,cx) -&gt;
      rx = <span class="keyword">if</span> rx &lt; <span class="number">0</span> <span class="keyword">then</span> rx + <span class="property">@rowCount</span> <span class="keyword">else</span> rx
      cx = <span class="keyword">if</span> cx &lt; <span class="number">0</span> <span class="keyword">then</span> cx + <span class="property">@columnCount</span> <span class="keyword">else</span> cx
      <span class="property">@$tdsRow</span>(rx).eq(cx)</pre></div></div>
            
        </li>
        
        
        <li id="section-472">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-472">&#182;</a>
              </div>
              <p>row: Get values at a given row</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    row: (rx, listOJML) -&gt;
      rx = <span class="property">@_bound</span> rx, <span class="property">@rowCount</span>, <span class="string">".row: rx"</span>
      <span class="keyword">if</span> listOJML?
        <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"oj.<span class="subst">#{@typeName}</span>: array expected for second argument with length length cellCount(<span class="subst">#{rx}</span>)"</span>) <span class="keyword">unless</span> listOJML.length == cellCount(rx)
        <span class="keyword">for</span> ojml,cx <span class="keyword">in</span> listOJML
          <span class="property">@$td</span>(rx,cx).oj ojml
        <span class="keyword">return</span>
      <span class="keyword">else</span>
        <span class="property">@$tdsRow</span>(rx).ojValues()</pre></div></div>
            
        </li>
        
        
        <li id="section-473">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-473">&#182;</a>
              </div>
              <p>cell: Get or set value at row rx, column cx</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    cell: (rx, cx, ojml) -&gt;
      <span class="keyword">if</span> ojml?
        <span class="property">@$td</span>(rx, cx).oj ojml
      <span class="keyword">else</span>
        <span class="property">@$td</span>(rx, cx).ojValue()</pre></div></div>
            
        </li>
        
        
        <li id="section-474">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-474">&#182;</a>
              </div>
              <h4>Manipulation Methods</h4>
<p>addRow: Add row to index rx</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    addRow: (rx, listOJML) -&gt;
      <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'oj.addRow: expected two arguments'</span>) <span class="keyword">unless</span> arguments.length == <span class="number">2</span>

      rx = <span class="property">@_bound</span> rx, <span class="property">@rowCount</span>+<span class="number">1</span>, <span class="string">".addRow: rx"</span>

      <span class="function"><span class="title">tr</span></span> =
        -&gt;
          oj.tr -&gt;
            <span class="keyword">for</span> o <span class="keyword">in</span> listOJML
              oj.td o

      <span class="property">@_addRowTR</span> rx, tr
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-475">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-475">&#182;</a>
              </div>
              <p>_addRowTR: Helper to add row directly with <code>&lt;tr&gt;</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _addRowTR: (rx, tr) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-476">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-476">&#182;</a>
              </div>
              <p>Empty</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> <span class="property">@rowCount</span> == <span class="number">0</span>
        <span class="property">@$el</span>.oj tr</pre></div></div>
            
        </li>
        
        
        <li id="section-477">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-477">&#182;</a>
              </div>
              <p>Last</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">else</span> <span class="keyword">if</span> rx == <span class="property">@rowCount</span>
        <span class="property">@$tr</span>(rx-<span class="number">1</span>).ojAfter tr</pre></div></div>
            
        </li>
        
        
        <li id="section-478">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-478">&#182;</a>
              </div>
              <p>Not last</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">else</span>
        <span class="property">@$tr</span>(rx).ojBefore tr

      <span class="property">@bodyChanged</span>()
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-479">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-479">&#182;</a>
              </div>
              <p>removeRow: Remove row at index rx (defaults to end)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    removeRow: (rx) -&gt;
      <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'oj.removeRow: expected one argument'</span>) <span class="keyword">unless</span> arguments.length == <span class="number">1</span>

      rx = <span class="property">@_bound</span> rx, <span class="property">@rowCount</span>, <span class="string">".removeRow: index"</span>
      out = <span class="property">@row</span> rx
      <span class="property">@$tr</span>(rx).remove()
      <span class="property">@bodyChanged</span>()
      out</pre></div></div>
            
        </li>
        
        
        <li id="section-480">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-480">&#182;</a>
              </div>
              <p>moveRow: Move row at index rx (defaults to end)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    moveRow: (rxFrom, rxTo) -&gt;
      <span class="keyword">return</span> <span class="keyword">if</span> rxFrom == rxTo

      rxFrom = <span class="property">@_bound</span> rxFrom, <span class="property">@rowCount</span>, <span class="string">".moveRow: fromIndex"</span>
      rxTo = <span class="property">@_bound</span> rxTo, <span class="property">@rowCount</span>, <span class="string">".moveRow: toIndex"</span>

      insert = <span class="keyword">if</span> rxTo &gt; rxFrom <span class="keyword">then</span> <span class="string">'insertAfter'</span> <span class="keyword">else</span> <span class="string">'insertBefore'</span>
      <span class="property">@$tr</span>(rxFrom)[insert] <span class="property">@$tr</span>(rxTo)

      <span class="property">@bodyChanged</span>()
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-481">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-481">&#182;</a>
              </div>
              <p>swapRow: Swap row rx1 and rx2</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    swapRow: (rx1, rx2) -&gt;
      <span class="keyword">return</span> <span class="keyword">if</span> rx1 == rx2

      rx1 = <span class="property">@_bound</span> rx1, <span class="property">@rowCount</span>, <span class="string">".swap: firstIndex"</span>
      rx2 = <span class="property">@_bound</span> rx2, <span class="property">@rowCount</span>, <span class="string">".swap: secondIndex"</span>

      <span class="keyword">if</span> Math.abs(rx1-rx2) == <span class="number">1</span>
        <span class="property">@moveRow</span> rx1, rx2
      <span class="keyword">else</span>
        rxMin = Math.min rx1, rx2
        rxMax = Math.max rx1, rx2
        <span class="property">@moveRow</span> rxMax, rxMin
        <span class="property">@moveRow</span> rxMin+<span class="number">1</span>, rxMax
      <span class="property">@bodyChanged</span>()
      <span class="keyword">return</span>

    unshiftRow: (v) -&gt; <span class="property">@addRow</span>(<span class="number">0</span>, v); <span class="keyword">return</span>
    shiftRow: -&gt; <span class="property">@removeRow</span> <span class="number">0</span>
    pushRow: (v) -&gt; <span class="property">@addRow</span>(<span class="property">@rowCount</span>, v); <span class="keyword">return</span>
    popRow: -&gt; <span class="property">@removeRow</span> -<span class="number">1</span>

    clearColgroup: -&gt; <span class="property">@$colgroup</span>.remove(); <span class="keyword">return</span>

    clearBody: -&gt; console.log <span class="string">"clearing body: oj.litcoffee:2930"</span>;<span class="property">@$tbody</span>.remove(); <span class="property">@bodyChanged</span>(); <span class="keyword">return</span>

    clearHeader: -&gt; <span class="property">@$thead</span>.remove(); <span class="property">@headerChanged</span>(); <span class="keyword">return</span>

    clearFooter: -&gt; <span class="property">@$tfoot</span>.remove(); <span class="property">@footerChanged</span>(); <span class="keyword">return</span>

    clearCaption: -&gt; <span class="property">@$capation</span>.remove(); <span class="keyword">return</span>

    clear: -&gt; <span class="property">@clearBody</span>(); <span class="property">@clearHeader</span>(); <span class="property">@clearFooter</span>(); <span class="property">@$caption</span>.remove()</pre></div></div>
            
        </li>
        
        
        <li id="section-482">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-482">&#182;</a>
              </div>
              <h4>Event Handlers</h4>
<p>When body changes clear relevant cached values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    bodyChanged: -&gt; <span class="property">@_rows</span> = <span class="literal">null</span>; <span class="property">@_columns</span> = <span class="literal">null</span>; <span class="property">@_$trs</span> = <span class="literal">null</span>; <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-483">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-483">&#182;</a>
              </div>
              <p>When header changes clear relevant cached values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    headerChanged: -&gt; <span class="property">@_header</span> = <span class="literal">null</span>; <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-484">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-484">&#182;</a>
              </div>
              <p>When footer changes clear relevant cached values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    footerChanged: -&gt; <span class="property">@_footer</span> = <span class="literal">null</span>; <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-485">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-485">&#182;</a>
              </div>
              <h4>Helper Methods</h4>
<p>_rowFromModel: Helper to map model to row</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _rowFromModel: (model) -&gt;
      oj =&gt;
        <span class="property">@each</span> model, oj.td</pre></div></div>
            
        </li>
        
        
        <li id="section-486">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-486">&#182;</a>
              </div>
              <p>_rowElFromItem: Helper to create rowTagName wrapped row</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _rowElFromItem: (row) -&gt;
      oj[<span class="property">@rowTagName</span>] row</pre></div></div>
            
        </li>
        
        
        <li id="section-487">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-487">&#182;</a>
              </div>
              <p>  _bound: Bound index to allow negatives, throw when out of range</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _bound: (ix, count, message) -&gt;
      _boundOrThrow ix, count, message, <span class="property">@typeName</span></pre></div></div>
            
        </li>
        
        
        <li id="section-488">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-488">&#182;</a>
              </div>
              <h2>oj.sandbox</h2>

            </div>
            
        </li>
        
        
        <li id="section-489">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-489">&#182;</a>
              </div>
              <p>The sandbox is a readonly version of oj that is exposed to the user</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.sandbox = {}
<span class="keyword">for</span> key <span class="keyword">in</span> _keys oj
  <span class="keyword">if</span> key.length &gt; <span class="number">0</span> <span class="keyword">and</span> key[<span class="number">0</span>] != <span class="string">'_'</span>
    oj.addProperty oj.sandbox, key, value:oj[key], writable:<span class="literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-490">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-490">&#182;</a>
              </div>
              <h2>oj.use(plugin, settings)</h2>

            </div>
            
        </li>
        
        
        <li id="section-491">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-491">&#182;</a>
              </div>
              <p>Include a plugin of OJ with <code>settings</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">use</span></span> = (plugin, settings = {}) -&gt;
  <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'oj.use: function expected for first argument'</span>) <span class="keyword">unless</span> oj.isFunction plugin
  <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'oj.use: object expected for second argument'</span>) <span class="keyword">unless</span> oj.isObject settings</pre></div></div>
            
        </li>
        
        
        <li id="section-492">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-492">&#182;</a>
              </div>
              <p>Call plugin to gather extension map</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  pluginMap = plugin oj, settings</pre></div></div>
            
        </li>
        
        
        <li id="section-493">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-493">&#182;</a>
              </div>
              <p>Extend all properties</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">for</span> name,value <span class="keyword">of</span> pluginMap
    oj[name] = value</pre></div></div>
            
        </li>
        
        
        <li id="section-494">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-494">&#182;</a>
              </div>
              <p>Add to sandbox</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    oj.addProperty oj.sandbox, name, value:value, writable: <span class="literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-495">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-495">&#182;</a>
              </div>
              <h2>_jqueryExtend(fn)</h2>

            </div>
            
        </li>
        
        
        <li id="section-496">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-496">&#182;</a>
              </div>
              <p>option.get is called to retrieve value per element
option.set is called when setting elements
option.first:true means return only the first get, otherwise it is returned as an array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_jqueryExtend</span></span> = (options = {}) -&gt;
  _defaults options, get:_identity, set:_identity, first: <span class="literal">false</span>
  -&gt;
    args = _toArray arguments
    $els = jQuery(@)</pre></div></div>
            
        </li>
        
        
        <li id="section-497">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-497">&#182;</a>
              </div>
              <p>Map over jquery selection if no arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (oj.isFunction options.get) <span class="keyword">and</span> args.length == <span class="number">0</span>
      out = []
      <span class="keyword">for</span> el <span class="keyword">in</span> $els
        out.push options.get $(el)
        <span class="keyword">if</span> options.first
          <span class="keyword">return</span> out[<span class="number">0</span>]
      out

    <span class="keyword">else</span> <span class="keyword">if</span> (oj.isFunction options.set)</pre></div></div>
            
        </li>
        
        
        <li id="section-498">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-498">&#182;</a>
              </div>
              <p>By default return this for chaining</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      out = $els
      <span class="keyword">for</span> el <span class="keyword">in</span> $els
        r = options.set $(el), args</pre></div></div>
            
        </li>
        
        
        <li id="section-499">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-499">&#182;</a>
              </div>
              <p>Short circuit if anything is returned</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">return</span> r <span class="keyword">if</span> r?

      $els

<span class="function"><span class="title">_triggerTypes</span></span> = (types) -&gt;
  <span class="keyword">for</span> type <span class="keyword">in</span> types
    type.inserted()
  <span class="keyword">return</span>

<span class="function"><span class="title">_insertStyles</span></span> = (pluginMap, options) -&gt;
  <span class="keyword">for</span> plugin, mediaMap <span class="keyword">of</span> pluginMap</pre></div></div>
            
        </li>
        
        
        <li id="section-500">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-500">&#182;</a>
              </div>
              <p>Skip global css if options.global is true</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">continue</span> <span class="keyword">if</span> plugin == <span class="string">'oj-style'</span> <span class="keyword">and</span> <span class="keyword">not</span> options?.global</pre></div></div>
            
        </li>
        
        
        <li id="section-501">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-501">&#182;</a>
              </div>
              <p>Create <style> tag for the plugin</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> $(<span class="string">'.'</span> + _styleClassFromPlugin plugin).length == <span class="number">0</span>
      $(<span class="string">'head'</span>).append oj._styleTagFromMediaObject plugin, mediaMap
  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-502">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-502">&#182;</a>
              </div>
              <h2>jQuery.fn.oj</h2>

            </div>
            
        </li>
        
        
        <li id="section-503">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-503">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>jQuery.fn.oj = _jqueryExtend
  set:($el, args) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-504">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-504">&#182;</a>
              </div>
              <p>No arguments return the first instance</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> args.length == <span class="number">0</span>
      <span class="keyword">return</span> $el[<span class="number">0</span>].oj</pre></div></div>
            
        </li>
        
        
        <li id="section-505">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-505">&#182;</a>
              </div>
              <p>Compile ojml</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    `<span class="javascript"><span class="keyword">with</span> (oj) {</span>`
    {dom,types,cssMap} = oj.compile {dom:<span class="number">1</span>,html:<span class="number">0</span>,cssMap:<span class="number">1</span>}, args...
    `<span class="javascript">}</span>`

    _insertStyles cssMap, global:<span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-506">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-506">&#182;</a>
              </div>
              <p>Reset content and append to dom</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $el.html <span class="string">''</span>
    dom = [dom] <span class="keyword">unless</span> oj.isArray dom
    $el.append(d) <span class="keyword">for</span> d <span class="keyword">in</span> dom

    _triggerTypes types

    <span class="keyword">return</span>

  get: ($el) -&gt;
    $el[<span class="number">0</span>].oj</pre></div></div>
            
        </li>
        
        
        <li id="section-507">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-507">&#182;</a>
              </div>
              <h2>jQuery.ojBody ojml</h2>

            </div>
            
        </li>
        
        
        <li id="section-508">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-508">&#182;</a>
              </div>
              <p>Replace body with ojml. Global css is rebuild when using this method.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>jQuery.<span class="function"><span class="title">ojBody</span></span> = (ojml) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-509">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-509">&#182;</a>
              </div>
              <p>  Compile only the body and below</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  bodyOnly = html:<span class="number">1</span>, <span class="string">'!DOCTYPE'</span>:<span class="number">1</span>, body:<span class="number">1</span>, head:<span class="string">'deep'</span>, meta:<span class="number">1</span>, title:<span class="string">'deep'</span>, link:<span class="string">'deep'</span>, script:<span class="string">'deep'</span>

  <span class="keyword">try</span>
    {dom,types,cssMap} = oj.compile dom:<span class="number">1</span>, html:<span class="number">0</span>, css:<span class="number">0</span>, cssMap:<span class="number">1</span>, ignore:bodyOnly, ojml

  <span class="keyword">catch</span> eCompile
    <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"oj.compile: <span class="subst">#{eCompile.message}</span>"</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-510">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-510">&#182;</a>
              </div>
              <p>  Clear body and insert dom elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  $(<span class="string">'body'</span>).html(dom) <span class="keyword">if</span> dom?

  _insertStyles cssMap, global:<span class="number">1</span>

  _triggerTypes types</pre></div></div>
            
        </li>
        
        
        <li id="section-511">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-511">&#182;</a>
              </div>
              <h2>jQuery.fn.ojValue</h2>

            </div>
            
        </li>
        
        
        <li id="section-512">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-512">&#182;</a>
              </div>
              <p>Get the first value of the selected contents</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_jqGetValue</span></span> = ($el, args) -&gt;

  el = $el[<span class="number">0</span>]
  child = el.firstChild

  <span class="keyword">switch</span> oj.typeOf child</pre></div></div>
            
        </li>
        
        
        <li id="section-513">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-513">&#182;</a>
              </div>
              <p>Parse the text to turn it into bool, number, or string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">when</span> <span class="string">'dom-text'</span>
      text = oj.parse child.nodeValue</pre></div></div>
            
        </li>
        
        
        <li id="section-514">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-514">&#182;</a>
              </div>
              <p>Get elements as oj instances or elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">when</span> <span class="string">'dom-element'</span>
      <span class="keyword">if</span> (inst = _getInstanceOnElement child)?
        inst
      <span class="keyword">else</span>
        child

jQuery.fn.ojValue = _jqueryExtend
  first: <span class="literal">true</span>
  set: <span class="literal">null</span>
  get: _jqGetValue</pre></div></div>
            
        </li>
        
        
        <li id="section-515">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-515">&#182;</a>
              </div>
              <h2>jQuery.fn.ojValues</h2>

            </div>
            
        </li>
        
        
        <li id="section-516">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-516">&#182;</a>
              </div>
              <p>Get values as an array of the selected element&#39;s contents</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>jQuery.fn.ojValues = _jqueryExtend
  first: <span class="literal">false</span>
  set: <span class="literal">null</span>
  get: _jqGetValue</pre></div></div>
            
        </li>
        
        
        <li id="section-517">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-517">&#182;</a>
              </div>
              <h2>jQuery plugins</h2>

            </div>
            
        </li>
        
        
        <li id="section-518">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-518">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>plugins =
  ojAfter: <span class="string">'after'</span>
  ojBefore: <span class="string">'before'</span>
  ojAppend: <span class="string">'append'</span>
  ojPrepend: <span class="string">'prepend'</span>
  ojReplaceWith: <span class="string">'replaceWith'</span>
  ojWrap: <span class="string">'wrap'</span>
  ojWrapInner: <span class="string">'wrapInner'</span>

<span class="keyword">for</span> ojName,jqName <span class="keyword">of</span> plugins
  <span class="keyword">do</span> (ojName, jqName) -&gt;
    jQuery.fn[ojName] = _jqueryExtend
      set: ($el, args) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-519">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-519">&#182;</a>
              </div>
              <p>Compile ojml for each one to separate references</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        {dom,types,cssMap} = oj.compile {dom:<span class="number">1</span>,html:<span class="number">0</span>,css:<span class="number">0</span>,cssMap:<span class="number">1</span>}, args...

        _insertStyles cssMap, global:<span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-520">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-520">&#182;</a>
              </div>
              <p>Append to the dom</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $el[jqName] dom

        _triggerTypes types

        <span class="keyword">return</span>

      get:<span class="literal">null</span></pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
